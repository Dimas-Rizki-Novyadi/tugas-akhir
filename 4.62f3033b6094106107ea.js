(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{Iab2:function(t,e,n){var r,i;void 0===(i="function"==typeof(r=function(){"use strict";function e(t,e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.onload=function(){s(r.response,e,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(t){var e=new XMLHttpRequest;e.open("HEAD",t,!1);try{e.send()}catch(t){}return 200<=e.status&&299>=e.status}function r(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(e){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,o=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),s=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(t,o,s){var a=i.URL||i.webkitURL,u=document.createElement("a");u.download=o=o||t.name||"download",u.rel="noopener","string"==typeof t?(u.href=t,u.origin===location.origin?r(u):n(u.href)?e(t,o,s):r(u,u.target="_blank")):(u.href=a.createObjectURL(t),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){r(u)},0))}:"msSaveOrOpenBlob"in navigator?function(t,i,o){if(i=i||t.name||"download","string"!=typeof t)navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Deprecated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\ufeff",t],{type:t.type}):t}(t,o),i);else if(n(t))e(t,i,o);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){r(s)})}}:function(t,n,r,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),"string"==typeof t)return e(t,n,r);var a="application/octet-stream"===t.type,u=/constructor/i.test(i.HTMLElement)||i.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||a&&u||o)&&"undefined"!=typeof FileReader){var h=new FileReader;h.onloadend=function(){var t=h.result;t=c?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=t:location=t,s=null},h.readAsDataURL(t)}else{var l=i.URL||i.webkitURL,f=l.createObjectURL(t);s?s.location=f:location.href=f,s=null,setTimeout(function(){l.revokeObjectURL(f)},4e4)}});i.saveAs=s.saveAs=s,t.exports=s})?r.apply(e,[]):r)||(t.exports=i)},jkDv:function(t,e,n){"use strict";n.r(e),n.d(e,"AdminModule",function(){return _p});var r=n("ofXK"),i=n("R0Ic"),o=n("fXoL"),s=n("H+bZ"),a=n("tyNb"),u=n("/t3+"),c=n("bTqV"),h=n("NFeN"),l=n("XhcP"),f=n("MutI"),d=n("FKr1");let p=(()=>{class t{constructor(t,e){this.api=t,this.router=e,this.mode="side",this.menu=[{name:"Dashboard",icon:"dashboard",url:"/admin/dashboard"}]}ngOnInit(){}checkLogin(){this.api.get("addresswithauth/status").subscribe(t=>{},t=>{this.router.navigate(["/login"])})}logout(){confirm("Are you sure you want to exit the application ?")&&(localStorage.removeItem("appToken"),window.location.reload()),this.router.navigate(["/login"])}}return t.\u0275fac=function(e){return new(e||t)(o.Ob(s.a),o.Ob(a.a))},t.\u0275cmp=o.Ib({type:t,selectors:[["app-admin"]],decls:36,vars:10,consts:[["color","primary","uk-navbar","",1,"uk-navbar-container",2,"position","fixed","z-index","2"],["mat-icon-button","",3,"click"],[1,"uk-animation-toggle","uk-animation-slide-left"],[1,"spacer"],[1,"example-container"],["mode","over",1,"sidenav-left",3,"position","opened","fixedInViewport","fixedTopGap","fixedBottomGap"],["sidenav",""],["routerLink","/admin/dashboard",3,"click"],["matListIcon",""],["matLine",""],["routerLink","/admin/address",3,"click"],["routerLink","/admin/about",3,"click"],[3,"click"],["mode","over",1,"example-sidenav",3,"position","fixedInViewport","fixedTopGap","fixedBottomGap"],[2,"padding","20px","background-image","url(assets/write.jpg)"]],template:function(t,e){if(1&t){const t=o.Vb();o.Sb(0),o.Ub(1,"mat-toolbar",0),o.Ub(2,"button",1),o.bc("click",function(){return o.rc(t),o.pc(10).toggle()}),o.Ub(3,"mat-icon",2),o.yc(4,"menu"),o.Tb(),o.Tb(),o.Ub(5,"span",2),o.yc(6,"ADDRESS BOOK"),o.Tb(),o.Pb(7,"span",3),o.Tb(),o.Ub(8,"mat-sidenav-container",4),o.Ub(9,"mat-sidenav",5,6),o.Ub(11,"mat-nav-list"),o.Ub(12,"mat-list-item",7),o.bc("click",function(){return o.rc(t),o.pc(10).toggle()}),o.Ub(13,"mat-icon",8),o.yc(14,"dashboard"),o.Tb(),o.Ub(15,"h3",9),o.yc(16,"Dashboard"),o.Tb(),o.Tb(),o.Ub(17,"mat-list-item",10),o.bc("click",function(){return o.rc(t),o.pc(10).toggle()}),o.Ub(18,"mat-icon",8),o.yc(19,"book"),o.Tb(),o.Ub(20,"h3",9),o.yc(21,"Address List"),o.Tb(),o.Tb(),o.Ub(22,"mat-list-item",11),o.bc("click",function(){return o.rc(t),o.pc(10).toggle()}),o.Ub(23,"mat-icon",8),o.yc(24,"info"),o.Tb(),o.Ub(25,"h3",9),o.yc(26,"About App"),o.Tb(),o.Tb(),o.Ub(27,"mat-list-item",12),o.bc("click",function(){return e.logout()}),o.Ub(28,"mat-icon",8),o.yc(29,"logout"),o.Tb(),o.Ub(30,"h3",9),o.yc(31,"Logout"),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Pb(32,"mat-sidenav",13,6),o.Ub(34,"mat-sidenav-content",14),o.Pb(35,"router-outlet"),o.Tb(),o.Tb(),o.Rb()}2&t&&(o.Db(9),o.kc("position","start")("opened",!1)("fixedInViewport",!0)("fixedTopGap",65)("fixedBottomGap",0),o.Db(23),o.kc("position","end")("fixedInViewport",!0)("fixedTopGap",60)("fixedBottomGap",0),o.Db(3),o.kc("@flyInOut",void 0))},directives:[u.a,c.a,h.a,l.b,l.a,f.d,f.b,a.b,f.a,d.j,l.c,a.d],styles:[".admin-container[_ngcontent-%COMP%]{bottom:0;display:flex;flex-direction:column;left:0;position:absolute;right:0;top:60px}.sidenav-left[_ngcontent-%COMP%]{top:60px;width:200px}"],data:{animation:[Object(i.m)("flyInOut",[Object(i.j)("in",Object(i.k)({width:120,transform:"translateX(0)",opacity:1})),Object(i.l)("void => *",[Object(i.k)({width:10,transform:"translateX(50px)",opacity:0})]),Object(i.l)("* => void",[])])]}}),t})();var y=n("Wp6s");let g=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Ib({type:t,selectors:[["app-dashboard"]],decls:39,vars:0,consts:[["tabindex","0",1,"uk-background-blend-multiply","uk-background-secondary","uk-background-top-center","uk-background-cover","uk-height-medium","uk-panel","uk-flex","uk-flex-center","uk-flex-middle","uk-animation-toggle","uk-animation-slide-top","uk-margin-large-top",2,"background-image","url(assets/address-book.jpg)"],[1,"header"],[1,"aside"],[1,"uk-article-title","uk-flex","uk-flex-center"],[1,"uk-divider-icon"],[1,"uk-article-meta","uk-flex","uk-flex-center"],[1,"uk-divider"],[1,"row"],[1,"col-1"],[1,"uk-animation-toggle","uk-animation-slide-left"],[1,"example-card-2"],["uk-grid","",1,"uk-card-header","uk-text-center","uk-grid-small","uk-child-width-auto"],["uk-grid","",1,"uk-card-body","uk-text-justify","uk-grid-small","uk-child-width-auto"],[1,"info1"],[1,"uk-card-footer","uk-flex"],[1,"uk-width-expand"],["mat-raised-button","","color","primary","routerLink","/admin/address"],[1,"col-2"],[1,"uk-animation-toggle","uk-animation-slide-right"],[1,"example-card-1"],[1,"info2"],["mat-raised-button","","color","primary","routerLink","/admin/about"]],template:function(t,e){1&t&&(o.Ub(0,"div",0),o.Ub(1,"div",1),o.Ub(2,"article",2),o.Ub(3,"h1",3),o.yc(4,"Welcome To The Address Book"),o.Tb(),o.Pb(5,"hr",4),o.Ub(6,"p",5),o.yc(7,"Collect locations and addresses of places and data of people closest to us in one web application."),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Pb(8,"hr",6),o.Ub(9,"div",7),o.Ub(10,"div",8),o.Ub(11,"div",9),o.Ub(12,"mat-card",10),o.Ub(13,"div",11),o.Ub(14,"h3"),o.Ub(15,"b"),o.yc(16,"Address List"),o.Tb(),o.Tb(),o.Tb(),o.Ub(17,"div",12),o.Ub(18,"p",13),o.yc(19,"In this section you can collect data related to location and address data belonging to the closest people or other important people."),o.Tb(),o.Tb(),o.Ub(20,"div",14),o.Pb(21,"span",15),o.Ub(22,"button",16),o.yc(23,"GO TO"),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Ub(24,"div",17),o.Ub(25,"div",18),o.Ub(26,"mat-card",19),o.Ub(27,"div",11),o.Ub(28,"h3"),o.Ub(29,"b"),o.yc(30,"About App"),o.Tb(),o.Tb(),o.Tb(),o.Ub(31,"div",12),o.Ub(32,"p",20),o.yc(33,"In this section you can get overall information regarding the type, date created, date of publication, name of the author and tools or frameworks that support the creation of this web application."),o.Tb(),o.Tb(),o.Ub(34,"div",14),o.Pb(35,"span",15),o.Ub(36,"button",21),o.yc(37,"GO TO"),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Pb(38,"router-outlet"))},directives:[y.a,c.a,a.b,a.d],styles:['h1[_ngcontent-%COMP%]{color:#add8e6;font-family:Times New Roman,Times,serif;font-size:50px}p[_ngcontent-%COMP%]{color:#f0f8ff;font-family:Franklin Gothic Medium,Arial Narrow,Arial,sans-serif;font-style:oblique}.info1[_ngcontent-%COMP%]{font-size:20px}.info1[_ngcontent-%COMP%], .info2[_ngcontent-%COMP%]{color:#faebd7;font-family:Lucida Sans,Lucida Sans Regular,Lucida Grande,Lucida Sans Unicode,Geneva,Verdana,sans-serif}.info2[_ngcontent-%COMP%]{font-size:16px}h3[_ngcontent-%COMP%]{color:#f0fff0;font-family:Times New Roman,Times,serif;font-size:30px}.example-card-1[_ngcontent-%COMP%]{background-color:#5f9ea0}.example-card-1[_ngcontent-%COMP%], .example-card-2[_ngcontent-%COMP%]{max-width:520px;min-height:290px}.example-card-2[_ngcontent-%COMP%]{background-color:#6495ed}[class*=example-card-][_ngcontent-%COMP%]{height:100%;width:100%}.row[_ngcontent-%COMP%]:after{content:"";display:table}[class*=col-][_ngcontent-%COMP%]{float:left;padding:25px}.col-2[_ngcontent-%COMP%]{float:right}.col-1[_ngcontent-%COMP%]{float:left}.aside[_ngcontent-%COMP%]{padding:15px;text-align:center}.header[_ngcontent-%COMP%]{padding:30px}']}),t})();var m=n("w55g"),v=n("Iab2"),b=n("0IaG"),w=n("D0XW"),T=n("HDdC"),I=n("Cfvw"),E=n("LRne"),O=n("JX91"),_=n("Zy1z"),S=n("lJxs"),D=n("Kqap"),k=n("/uUt"),A=n("pLZG"),N=n("pxpQ"),x=n("spgP"),C=n("Jgta"),j=n("zIRd"),R=n("qOnz"),U=n("q/0M"),P=function(t,e){return(P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function L(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var M,F="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},q=q||{},V=F||self;function B(){}function K(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function G(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var z="closure_uid_"+(1e9*Math.random()>>>0),Q=0;function H(t,e,n){return t.call.apply(t.bind,arguments)}function W(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Y(t,e,n){return(Y=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?H:W).apply(null,arguments)}function X(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function J(){return Date.now()}function $(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Z(){this.j=this.j,this.i=this.i}Z.prototype.j=!1,Z.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,z)&&t[z]||(t[z]=++Q)}(this)},Z.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var tt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},et=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function nt(t){return Array.prototype.concat.apply([],arguments)}function rt(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function it(t){return/^[\s\xa0]*$/.test(t)}var ot,st=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function at(t,e){return-1!=t.indexOf(e)}function ut(t,e){return t<e?-1:t>e?1:0}t:{var ct=V.navigator;if(ct){var ht=ct.userAgent;if(ht){ot=ht;break t}}ot=""}function lt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function ft(t){var e={};for(var n in t)e[n]=t[n];return e}var dt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function pt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<dt.length;o++)n=dt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function yt(t){return yt[" "](t),t}yt[" "]=B;var gt,mt,vt=at(ot,"Opera"),bt=at(ot,"Trident")||at(ot,"MSIE"),wt=at(ot,"Edge"),Tt=wt||bt,It=at(ot,"Gecko")&&!(at(ot.toLowerCase(),"webkit")&&!at(ot,"Edge"))&&!(at(ot,"Trident")||at(ot,"MSIE"))&&!at(ot,"Edge"),Et=at(ot.toLowerCase(),"webkit")&&!at(ot,"Edge");function Ot(){var t=V.document;return t?t.documentMode:void 0}t:{var _t="",St=(mt=ot,It?/rv:([^\);]+)(\)|;)/.exec(mt):wt?/Edge\/([\d\.]+)/.exec(mt):bt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(mt):Et?/WebKit\/(\S+)/.exec(mt):vt?/(?:Version)[ \/]?(\S+)/.exec(mt):void 0);if(St&&(_t=St?St[1]:""),bt){var Dt=Ot();if(null!=Dt&&Dt>parseFloat(_t)){gt=String(Dt);break t}}gt=_t}var kt={};function At(t){return function(t,e){var n=kt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=st(String(gt)).split("."),r=st(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=ut(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||ut(0==s[2].length,0==a[2].length)||ut(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var Nt=V.document&&bt&&(Ot()||parseInt(gt,10))||void 0,xt=!bt||9<=Number(Nt),Ct=bt&&!At("9"),jt=function(){if(!V.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{V.addEventListener("test",B,e),V.removeEventListener("test",B,e)}catch(n){}return t}();function Rt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Ut(t,e){if(Rt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(It){t:{try{yt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Pt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Rt.prototype.b=function(){this.defaultPrevented=!0},$(Ut,Rt);var Pt={2:"touch",3:"pen",4:"mouse"};Ut.prototype.b=function(){Ut.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Ct)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Lt="closure_listenable_"+(1e6*Math.random()|0),Mt=0;function Ft(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Mt,this.Y=this.Z=!1}function qt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Vt(t){this.src=t,this.a={},this.b=0}function Bt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=tt(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(qt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Kt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Vt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Kt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Ft(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Gt="closure_lm_"+(1e6*Math.random()|0),zt={};function Qt(t,e,n,r,i){if(r&&r.once)return Wt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Qt(t,e[o],n,r,i);return null}return n=ne(n),t&&t[Lt]?t.va(e,n,G(r)?!!r.capture:!!r,i):Ht(t,e,n,!1,r,i)}function Ht(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=G(i)?!!i.capture:!!i;if(s&&!xt)return null;var a=te(t);if(a||(t[Gt]=a=new Vt(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Zt,e=xt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)jt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Jt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Wt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Wt(t,e[o],n,r,i);return null}return n=ne(n),t&&t[Lt]?t.wa(e,n,G(r)?!!r.capture:!!r,i):Ht(t,e,n,!0,r,i)}function Yt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Yt(t,e[o],n,r,i);else r=G(r)?!!r.capture:!!r,n=ne(n),t&&t[Lt]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=Kt(o=t.a[e],n,r,i))&&(qt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=te(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Kt(e,n,r,i)),(n=-1<t?e[t]:null)&&Xt(n))}function Xt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Lt])Bt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Jt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=te(e))?(Bt(n,t),0==n.b&&(n.src=null,e[Gt]=null)):qt(t)}}}function Jt(t){return t in zt?zt[t]:zt[t]="on"+t}function $t(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Xt(t),n.call(r,e)}function Zt(t,e){if(t.Y)return!0;if(!xt){if(!e)t:{e=["window","event"];for(var n=V,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return $t(t,e=new Ut(e,this))}return $t(t,new Ut(e,this))}function te(t){return(t=t[Gt])instanceof Vt?t:null}var ee="__closure_events_fn_"+(1e9*Math.random()>>>0);function ne(t){return"function"==typeof t?t:(t[ee]||(t[ee]=function(e){return t.handleEvent(e)}),t[ee])}function re(){Z.call(this),this.c=new Vt(this),this.J=this,this.C=null}function ie(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new Rt(e,t);else if(e instanceof Rt)e.target=e.target||t;else{var i=e;pt(e=new Rt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=oe(s,r,!0,e)&&i}if(i=oe(s=e.a=t,r,!0,e)&&i,i=oe(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=oe(s=e.a=n[o],r,!1,e)&&i}function oe(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&Bt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}$(re,Z),re.prototype[Lt]=!0,(M=re.prototype).addEventListener=function(t,e,n,r){Qt(this,t,e,n,r)},M.removeEventListener=function(t,e,n,r){Yt(this,t,e,n,r)},M.G=function(){if(re.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)qt(n[r]);delete e.a[t],e.b--}}this.C=null},M.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},M.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var se=V.JSON.stringify;function ae(){this.b=this.a=null}var ue,ce=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())(function(){return new le},function(t){t.reset()});function he(){var t=ye,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function le(){this.next=this.b=this.a=null}function fe(t){V.setTimeout(function(){throw t},0)}function de(t,e){ue||function(){var t=V.Promise.resolve(void 0);ue=function(){t.then(ge)}}(),pe||(ue(),pe=!0),ye.add(t,e)}ae.prototype.add=function(t,e){var n=ce.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},le.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},le.prototype.reset=function(){this.next=this.b=this.a=null};var pe=!1,ye=new ae;function ge(){for(var t;t=he();){try{t.a.call(t.b)}catch(n){fe(n)}var e=ce;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}pe=!1}function me(t,e){re.call(this),this.b=t||1,this.a=e||V,this.f=Y(this.Za,this),this.g=J()}function ve(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function be(t,e,n){if("function"==typeof t)n&&(t=Y(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Y(t.handleEvent,t)}return 2147483647<Number(e)?-1:V.setTimeout(t,e||0)}function we(t){t.a=be(function(){t.a=null,t.c&&(t.c=!1,we(t))},t.h);var e=t.b;t.b=null,t.g.apply(null,e)}$(me,re),(M=me.prototype).aa=!1,M.M=null,M.Za=function(){if(this.aa){var t=J()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),ie(this,"tick"),this.aa&&(ve(this),this.start()))}},M.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=J())},M.G=function(){me.X.G.call(this),ve(this),delete this.a};var Te=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:we(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(V.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(Z);function Ie(t){Z.call(this),this.b=t,this.a={}}$(Ie,Z);var Ee=[];function Oe(t,e,n,r){Array.isArray(n)||(n&&(Ee[0]=n.toString()),n=Ee);for(var i=0;i<n.length;i++){var o=Qt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function _e(t){lt(t.a,function(t,e){this.a.hasOwnProperty(e)&&Xt(t)},t),t.a={}}function Se(){this.a=!0}function De(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return se(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}Ie.prototype.G=function(){Ie.X.G.call(this),_e(this)},Ie.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Se.prototype.info=function(){};var ke={},Ae=null;function Ne(){return Ae=Ae||new re}function xe(t){Rt.call(this,ke.Fa,t)}function Ce(t){var e=Ne();ie(e,new xe(e,t))}function je(t,e){Rt.call(this,ke.STAT_EVENT,t),this.stat=e}function Re(t){var e=Ne();ie(e,new je(e,t))}function Ue(t){Rt.call(this,ke.Ga,t)}function Pe(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return V.setTimeout(function(){t()},e)}ke.Fa="serverreachability",$(xe,Rt),ke.STAT_EVENT="statevent",$(je,Rt),ke.Ga="timingevent",$(Ue,Rt);var Le={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Me={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Fe(){}function qe(){}Fe.prototype.a=null;var Ve,Be={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Ke(){Rt.call(this,"d")}function Ge(){Rt.call(this,"c")}function ze(){}function Qe(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new Ie(this),this.P=He,this.R=new me(t=Tt?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}$(Ke,Rt),$(Ge,Rt),$(ze,Fe),Ve=new ze;var He=45e3,We={},Ye={};function Xe(t,e,n){t.H=1,t.i=bn(dn(e)),t.j=n,t.I=!0,Je(t,null)}function Je(t,e){t.u=J(),tn(t),t.l=dn(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),Cn(n.b,"t",r),t.D=0,t.a=Sr(t.g,t.g.C?e:null),0<t.O&&(t.F=new Te(Y(t.Ca,t,t.a),t.O)),Oe(t.J,t.a,"readystatechange",t.Xa),e=t.B?ft(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Ce(1),function(t,e,n,r,i,o){t.info(function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.c,t.m,t.l,t.f,t.S,t.j)}function $e(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Ze(t,n);if(i==Ye){4==e&&(t.h=4,Re(14),r=!1),De(t.c,t.f,null,"[Incomplete Response]");break}if(i==We){t.h=4,Re(15),De(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}De(t.c,t.f,i,null),sn(t,i)}4==e&&0==n.length&&(t.h=1,Re(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),vr(e),e.F=!0,Re(11))):(De(t.c,t.f,n,"[Invalid Chunked Response]"),on(t),rn(t))}function Ze(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Ye:(n=Number(e.substring(n,r)),isNaN(n)?We:(r+=1)+n>e.length?Ye:(e=e.substr(r,n),t.D=r+n,e))}function tn(t){t.T=J()+t.P,en(t,t.P)}function en(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Pe(Y(t.Va,t),e)}function nn(t){t.o&&(V.clearTimeout(t.o),t.o=null)}function rn(t){0==t.g.v||t.A||Tr(t.g,t)}function on(t){nn(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ve(t.R),_e(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function sn(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||Fn(n.b,t)))if(n.I=t.N,!t.C&&Fn(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(cd){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;wr(n),cr(n)}mr(n),Re(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=Pe(Y(n.Sa,n),6e3));if(1>=Mn(n.b)&&n.ea){try{n.ea()}catch(cd){}n.ea=void 0}}else Er(n,11)}else if((t.C||n.a==t)&&wr(n),!it(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(at(h,"spdy")||at(h,"quic")||at(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(qn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,vn(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=J()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=_r(u,u.C?u.ga:null,u.fa),d.C){Vn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(nn(p),tn(p)),u.a=d}else gr(u);0<n.g.length&&fr(n)}else"stop"!=i[0]&&"close"!=i[0]||Er(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Er(n,7):ur(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);Ce(4)}catch(cd){}}function an(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(K(t)||"string"==typeof t)et(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(K(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(K(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function un(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof un)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function cn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];hn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)hn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function hn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(M=Qe.prototype).setTimeout=function(t){this.P=t},M.Xa=function(t){t=t.target;var e=this.F;e&&3==ir(t)?e.f():this.Ca(t)},M.Ca=function(t){try{if(t==this.a)t:{var e=ir(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!Tt&&!this.a.$())){this.A||4!=e||7==n||Ce(8==n||0>=r?3:2),nn(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!it(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,Re(12),on(this),rn(this);break t}De(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,sn(this,u)}this.I?($e(this,e,o),Tt&&this.b&&3==e&&(Oe(this.J,this.R,"tick",this.Wa),this.R.start())):(De(this.c,this.f,o,null),sn(this,o)),4==e&&on(this),this.b&&!this.A&&(4==e?Tr(this.g,this):(this.b=!1,tn(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Re(12)):(this.h=0,Re(13)),on(this),rn(this)}}}catch(c){}},M.Wa=function(){if(this.a){var t=ir(this.a),e=this.a.$();this.D<e.length&&(nn(this),$e(this,t,e),this.b&&4!=t&&tn(this))}},M.cancel=function(){this.A=!0,on(this)},M.Va=function(){this.o=null;var t=J();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(Ce(3),Re(17)),on(this),this.h=2,rn(this)):en(this,this.T-t)},(M=un.prototype).K=function(){cn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},M.L=function(){return cn(this),this.a.concat()},M.get=function(t,e){return hn(this.b,t)?this.b[t]:e},M.set=function(t,e){hn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},M.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var ln=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function fn(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof fn){this.a=void 0!==e?e:t.a,pn(this,t.f),this.j=t.j,yn(this,t.c),gn(this,t.h),this.g=t.g,e=t.b;var n=new kn;n.c=e.c,e.a&&(n.a=new un(e.a),n.b=e.b),mn(this,n),this.i=t.i}else t&&(n=String(t).match(ln))?(this.a=!!e,pn(this,n[1]||"",!0),this.j=wn(n[2]||""),yn(this,n[3]||"",!0),gn(this,n[4]),this.g=wn(n[5]||"",!0),mn(this,n[6]||"",!0),this.i=wn(n[7]||"")):(this.a=!!e,this.b=new kn(null,this.a))}function dn(t){return new fn(t)}function pn(t,e,n){t.f=n?wn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function yn(t,e,n){t.c=n?wn(e,!0):e}function gn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function mn(t,e,n){e instanceof kn?(t.b=e,function(t,e){e&&!t.f&&(An(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Nn(this,e),Cn(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=Tn(e,Sn)),t.b=new kn(e,t.a))}function vn(t,e,n){t.b.set(e,n)}function bn(t){return vn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^J()).toString(36)),t}function wn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Tn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,In),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function In(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}fn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Tn(e,En,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Tn(e,En,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Tn(n,"/"==n.charAt(0)?_n:On,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Tn(n,Dn)),t.join("")};var En=/[#\/\?@]/g,On=/[#\?:]/g,_n=/[#\?]/g,Sn=/[#\?@]/g,Dn=/#/g;function kn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function An(t){t.a||(t.a=new un,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Nn(t,e){An(t),e=jn(t,e),hn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,hn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&cn(t)))}function xn(t,e){return An(t),e=jn(t,e),hn(t.a.b,e)}function Cn(t,e,n){Nn(t,e),0<n.length&&(t.c=null,t.a.set(jn(t,e),rt(n)),t.b+=n.length)}function jn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(M=kn.prototype).add=function(t,e){An(this),this.c=null,t=jn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},M.forEach=function(t,e){An(this),this.a.forEach(function(n,r){et(n,function(n){t.call(e,n,r,this)},this)},this)},M.L=function(){An(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},M.K=function(t){An(this);var e=[];if("string"==typeof t)xn(this,t)&&(e=nt(e,this.a.get(jn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=nt(e,t[n])}return e},M.set=function(t,e){return An(this),this.c=null,xn(this,t=jn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},M.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},M.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var Rn=function(){return function(t,e){this.b=t,this.a=e}}();function Un(t){this.g=t||Pn,t=V.PerformanceNavigationTiming?0<(t=V.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(V.ia&&V.ia.ya&&V.ia.ya()&&V.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Pn=10;function Ln(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Mn(t){return t.b?1:t.a?t.a.size:0}function Fn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function qn(t,e){t.a?t.a.add(e):t.b=e}function Vn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Bn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=L(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return rt(t.c)}function Kn(){}function Gn(){this.a=new Kn}function zn(t,e,n){var r=n||"";try{an(t,function(t,n){var i=t;G(t)&&(i=se(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Qd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Qd}}function Qn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}Un.prototype.cancel=function(){var t,e;if(this.c=Bn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=L(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Kn.prototype.stringify=function(t){return V.JSON.stringify(t,void 0)},Kn.prototype.parse=function(t){return V.JSON.parse(t,void 0)};var Hn=V.JSON.parse;function Wn(t){re.call(this),this.headers=new un,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Yn,this.D=this.F=!1}$(Wn,re);var Yn="",Xn=/^https?$/i,Jn=["POST","PUT"];function $n(t){return"content-type"==t.toLowerCase()}function Zn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,tr(t),nr(t)}function tr(t){t.u||(t.u=!0,ie(t,"complete"),ie(t,"error"))}function er(t){if(t.b&&void 0!==q&&(!t.s[1]||4!=ir(t)||2!=t.W()))if(t.l&&4==ir(t))be(t.za,0,t);else if(ie(t,"readystatechange"),4==ir(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(ln)[1]||null;if(!o&&V.self&&V.self.location){var s=V.self.location.protocol;o=s.substr(0,s.length-1)}i=!Xn.test(o?o.toLowerCase():"")}e=i}if(e)ie(t,"complete"),ie(t,"success");else{t.h=6;try{var a=2<ir(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",tr(t)}}finally{nr(t)}}}function nr(t,e){if(t.a){rr(t);var n=t.a,r=t.s[0]?B:null;t.a=null,t.s=null,e||ie(t,"ready");try{n.onreadystatechange=r}catch(Qd){}}}function rr(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(V.clearTimeout(t.m),t.m=null)}function ir(t){return t.a?t.a.readyState:0}function or(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return lt(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):vn(t,e,n))}function sr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function ar(t){this.pa=0,this.g=[],this.c=new Se,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=sr("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=sr("baseRetryDelayMs",5e3,t),this.Ra=sr("retryDelaySeedMs",1e4,t),this.Ma=sr("forwardChannelMaxRetries",2,t),this.ma=sr("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new Un(t&&t.concurrentRequestLimit),this.ka=new Gn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function ur(t){if(hr(t),3==t.v){var e=t.R++,n=dn(t.B);vn(n,"SID",t.J),vn(n,"RID",e),vn(n,"TYPE","terminate"),pr(t,n),(e=new Qe(t,t.c,e,void 0)).H=2,e.i=bn(dn(n)),n=!1,V.navigator&&V.navigator.sendBeacon&&(n=V.navigator.sendBeacon(e.i.toString(),"")),!n&&V.Image&&((new Image).src=e.i,n=!0),n||(e.a=Sr(e.g,null),e.a.ba(e.i)),e.u=J(),tn(e)}Or(t)}function cr(t){t.a&&(vr(t),t.a.cancel(),t.a=null)}function hr(t){cr(t),t.j&&(V.clearTimeout(t.j),t.j=null),wr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&V.clearTimeout(t.h),t.h=null)}function lr(t,e){t.g.push(new Rn(t.Oa++,e)),3==t.v&&fr(t)}function fr(t){Ln(t.b)||t.h||(t.h=!0,de(t.Ba,t),t.u=0)}function dr(t,e){var n;n=e?e.f:t.R++;var r=dn(t.B);vn(r,"SID",t.J),vn(r,"RID",n),vn(r,"AID",t.P),pr(t,r),t.i&&t.l&&or(r,t.i,t.l),n=new Qe(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=yr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),qn(t.b,n),Xe(n,r,e)}function pr(t,e){t.f&&an({},function(t,n){vn(e,n,t)})}function yr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?Y(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{zn(h,s,"req"+c+"_")}catch(ri){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function gr(t){t.a||t.j||(t.T=1,de(t.Aa,t),t.o=0)}function mr(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=Pe(Y(t.Aa,t),Ir(t,t.o)),t.o++,0))}function vr(t){null!=t.s&&(V.clearTimeout(t.s),t.s=null)}function br(t){t.a=new Qe(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=dn(t.la);vn(e,"RID","rpc"),vn(e,"SID",t.J),vn(e,"CI",t.H?"0":"1"),vn(e,"AID",t.P),pr(t,e),vn(e,"TYPE","xmlhttp"),t.i&&t.l&&or(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=bn(dn(e)),n.j=null,n.I=!0,Je(n,t)}function wr(t){null!=t.m&&(V.clearTimeout(t.m),t.m=null)}function Tr(t,e){var n=null;if(t.a==e){wr(t),vr(t),t.a=null;var r=2}else{if(!Fn(t.b,e))return;n=e.s,Vn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=J()-e.u;var i=t.u;ie(r=Ne(),new Ue(r,n,e,i)),fr(t)}else gr(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Mn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.La?0:t.Ma)||(t.h=Pe(Y(t.Ba,t,e),Ir(t,t.u)),t.u++,0)))}(t,e)||2==r&&mr(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:Er(t,5);break;case 4:Er(t,10);break;case 3:Er(t,6);break;default:Er(t,2)}}function Ir(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function Er(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=Y(t.Ya,t);n||(n=new fn("//www.google.com/images/cleardot.gif"),V.location&&"http"==V.location.protocol||pn(n,"https"),bn(n)),function(t,e){var n=new Se;if(V.Image){var r=new Image;r.onload=X(Qn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=X(Qn,n,r,"TestLoadImage: error",!1,e),r.onabort=X(Qn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=X(Qn,n,r,"TestLoadImage: timeout",!1,e),V.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Re(2);t.v=0,t.f&&t.f.ra(e),Or(t),hr(t)}function Or(t){t.v=0,t.I=-1,t.f&&(0==Bn(t.b).length&&0==t.g.length||(t.b.c.length=0,rt(t.g),t.g.length=0),t.f.qa())}function _r(t,e,n){var r=function(t){return t instanceof fn?dn(t):new fn(t,void 0)}(n);if(""!=r.c)e&&yn(r,e+"."+r.c),gn(r,r.h);else{var i=V.location;r=function(t,e,n,r){var i=new fn(null,void 0);return t&&pn(i,t),e&&yn(i,e),n&&gn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&lt(t.V,function(t,e){vn(r,e,t)}),n=t.na,(e=t.A)&&n&&vn(r,e,n),vn(r,"VER",t.ha),pr(t,r),r}function Sr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Wn(t.Na)).F=t.C,e}function Dr(){}function kr(){if(bt&&!(10<=Number(Nt)))throw Error("Environmental error: no available transport.")}function Ar(t,e){re.call(this),this.a=new ar(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!it(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!it(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new Cr(this)}function Nr(t){Ke.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function xr(){Ge.call(this),this.status=1}function Cr(t){this.a=t}(M=Wn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=function(t){var e;return(e=t.a)||(e=t.a={}),e}(this.H?this.H:Ve),this.a.onreadystatechange=Y(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Zn(this,o)}t=n||"";var i=new un(this.headers);r&&an(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=$n,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=V.FormData&&t instanceof V.FormData,!(0<=tt(Jn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{rr(this),0<this.o&&((this.D=function(t){return bt&&At(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Y(this.xa,this)):this.m=be(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Zn(this,o)}},M.xa=function(){void 0!==q&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,ie(this,"timeout"),this.abort(8))},M.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,ie(this,"complete"),ie(this,"abort"),nr(this))},M.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),nr(this,!0)),Wn.X.G.call(this)},M.za=function(){this.j||(this.A||this.l||this.g?er(this):this.Ua())},M.Ua=function(){er(this)},M.W=function(){try{return 2<ir(this)?this.a.status:-1}catch(mt){return-1}},M.$=function(){try{return this.a?this.a.responseText:""}catch(mt){return""}},M.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Hn(e)}},M.ua=function(){return this.h},M.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(M=ar.prototype).ha=8,M.v=1,M.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Qe(this,this.c,t,void 0),r=this.l;if(this.O&&(r?pt(r=ft(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=yr(this,n,e),vn(i=dn(this.B),"RID",t),vn(i,"CVER",22),this.A&&vn(i,"X-HTTP-Session-Id",this.A),pr(this,i),this.i&&r&&or(i,this.i,r),qn(this.b,n),this.Ia&&vn(i,"TYPE","init"),this.da?(vn(i,"$req",e),vn(i,"SID","null"),n.U=!0,Xe(n,i,null)):Xe(n,i,e),this.v=2}}else 3==this.v&&(t?dr(this,t):0==this.g.length||Ln(this.b)||dr(this))},M.Aa=function(){if(this.j=null,br(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=Pe(Y(this.Ta,this),t)}},M.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Re(10),cr(this),br(this))},M.Sa=function(){null!=this.m&&(this.m=null,cr(this),mr(this),Re(19))},M.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),Re(2)):(this.c.info("Failed to ping google.com"),Re(1))},(M=Dr.prototype).ta=function(){},M.sa=function(){},M.ra=function(){},M.qa=function(){},M.Ja=function(){},kr.prototype.a=function(t,e){return new Ar(t,e)},$(Ar,re),Ar.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;Re(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=_r(t,null,t.fa),fr(t)},Ar.prototype.close=function(){ur(this.a)},Ar.prototype.h=function(t){if("string"==typeof t){var e={};e.__data__=t,lr(this.a,e)}else this.l?((e={}).__data__=se(t),lr(this.a,e)):lr(this.a,t)},Ar.prototype.G=function(){this.a.f=null,delete this.f,ur(this.a),delete this.a,Ar.X.G.call(this)},$(Nr,Ke),$(xr,Ge),$(Cr,Dr),Cr.prototype.ta=function(){ie(this.a,"a")},Cr.prototype.sa=function(t){ie(this.a,new Nr(t))},Cr.prototype.ra=function(t){ie(this.a,new xr(t))},Cr.prototype.qa=function(){ie(this.a,"b")},kr.prototype.createWebChannel=kr.prototype.a,Ar.prototype.send=Ar.prototype.h,Ar.prototype.open=Ar.prototype.g,Ar.prototype.close=Ar.prototype.close,Le.NO_ERROR=0,Le.TIMEOUT=8,Le.HTTP_ERROR=6,Me.COMPLETE="complete",qe.EventType=Be,Be.OPEN="a",Be.CLOSE="b",Be.ERROR="c",Be.MESSAGE="d",re.prototype.listen=re.prototype.va,Wn.prototype.listenOnce=Wn.prototype.wa,Wn.prototype.getLastError=Wn.prototype.Qa,Wn.prototype.getLastErrorCode=Wn.prototype.ua,Wn.prototype.getStatus=Wn.prototype.W,Wn.prototype.getResponseJson=Wn.prototype.Pa,Wn.prototype.getResponseText=Wn.prototype.$,Wn.prototype.send=Wn.prototype.ba;var jr=Le,Rr=Me,Ur=ke,Pr=qe,Lr=Wn,Mr=n("mrSG"),Fr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Fr.o=-1;var qr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Vr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(Mr.c)(e,t),e}(Error),Br=new U.b("@firebase/firestore");function Kr(){return Br.logLevel}function Gr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Br.logLevel<=U.a.DEBUG){var r=e.map(Hr);Br.debug.apply(Br,Object(Mr.f)(["Firestore (8.5.0): "+t],r))}}function zr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Br.logLevel<=U.a.ERROR){var r=e.map(Hr);Br.error.apply(Br,Object(Mr.f)(["Firestore (8.5.0): "+t],r))}}function Qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Br.logLevel<=U.a.WARN){var r=e.map(Hr);Br.warn.apply(Br,Object(Mr.f)(["Firestore (8.5.0): "+t],r))}}function Hr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Qd){return t}}function Wr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.5.0) INTERNAL ASSERTION FAILED: "+t;throw zr(e),new Error(e)}function Yr(t,e){t||Wr()}function Xr(t,e){return t}function Jr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var $r=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Jr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Zr(t,e){return t<e?-1:t>e?1:0}function ti(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function ei(t){return t+"\0"}var ni=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Vr(qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Vr(qr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Vr(qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Vr(qr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Zr(this.nanoseconds,t.nanoseconds):Zr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),ri=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ni(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function ii(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function oi(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function si(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ai=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Wr(),void 0===n?n=t.length-e:n>t.length-e&&Wr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ui=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Mr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Vr(qr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(ai),ci=/^[_a-zA-Z][_a-zA-Z0-9]*$/,hi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Mr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ci.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Vr(qr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Vr(qr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Vr(qr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Vr(qr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(ai),li=function(){function t(t){this.fields=t,t.sort(hi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return ti(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),fi=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Zr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();fi.EMPTY_BYTE_STRING=new fi("");var di=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pi(t){if(Yr(!!t),"string"==typeof t){var e=0,n=di.exec(t);if(Yr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:yi(t.seconds),nanos:yi(t.nanos)}}function yi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function gi(t){return"string"==typeof t?fi.fromBase64String(t):fi.fromUint8Array(t)}function mi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function vi(t){var e=t.mapValue.fields.__previous_value__;return mi(e)?vi(e):e}function bi(t){var e=pi(t.mapValue.fields.__local_write_time__.timestampValue);return new ni(e.seconds,e.nanos)}function wi(t){return null==t}function Ti(t){return 0===t&&1/t==-1/0}function Ii(t){return"number"==typeof t&&Number.isInteger(t)&&!Ti(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ei=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(ui.fromString(e))},t.fromName=function(e){return new t(ui.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ui.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ui.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ui(e.slice()))},t}();function Oi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?mi(t)?4:10:Wr()}function _i(t,e){var n=Oi(t);if(n!==Oi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return bi(t).isEqual(bi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=pi(t.timestampValue),r=pi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return gi(t.bytesValue).isEqual(gi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return yi(t.geoPointValue.latitude)===yi(e.geoPointValue.latitude)&&yi(t.geoPointValue.longitude)===yi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return yi(t.integerValue)===yi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=yi(t.doubleValue),r=yi(e.doubleValue);return n===r?Ti(n)===Ti(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ti(t.arrayValue.values||[],e.arrayValue.values||[],_i);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ii(n)!==ii(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!_i(n[i],r[i])))return!1;return!0}(t,e);default:return Wr()}}function Si(t,e){return void 0!==(t.values||[]).find(function(t){return _i(t,e)})}function Di(t,e){var n=Oi(t),r=Oi(e);if(n!==r)return Zr(n,r);switch(n){case 0:return 0;case 1:return Zr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=yi(t.integerValue||t.doubleValue),r=yi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ki(t.timestampValue,e.timestampValue);case 4:return ki(bi(t),bi(e));case 5:return Zr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=gi(t),r=gi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Zr(n[i],r[i]);if(0!==o)return o}return Zr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Zr(yi(t.latitude),yi(e.latitude));return 0!==n?n:Zr(yi(t.longitude),yi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Di(n[i],r[i]);if(o)return o}return Zr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Zr(r[s],o[s]);if(0!==a)return a;var u=Di(n[r[s]],i[o[s]]);if(0!==u)return u}return Zr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Wr()}}function ki(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Zr(t,e);var n=pi(t),r=pi(e),i=Zr(n.seconds,r.seconds);return 0!==i?i:Zr(n.nanos,r.nanos)}function Ai(t){return Ni(t)}function Ni(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=pi(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?gi(t.bytesValue).toBase64():"referenceValue"in t?Ei.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Ni(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Ni(t.fields[o])}return e+"}"}(t.mapValue):Wr();var e}function xi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ci(t){return!!t&&"integerValue"in t}function ji(t){return!!t&&"arrayValue"in t}function Ri(t){return!!t&&"nullValue"in t}function Ui(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Pi(t){return!!t&&"mapValue"in t}var Li=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(hi.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach(function(t,n){t?e.set(n,t):e.delete(n)})},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return _i(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Oi(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=Pi(o)?Object.assign({},o.mapValue.fields):{};return n.forEach(function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)}),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(hi.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!Pi(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function Mi(t){var e=[];return oi(t.fields||{},function(t,n){var r=new hi([t]);if(Pi(n)){var i=Mi(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new li(e)}var Fi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,ri.min(),Li.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Li.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Li.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Li.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Li.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),qi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Vi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new qi(t,e,n,r,i,o,s)}function Bi(t){var e=Xr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Ai(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),wi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=eo(e.startAt)),e.endAt&&(n+="|ub:",n+=eo(e.endAt)),e.h=n}return e.h}function Ki(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!ro(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!_i(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!oo(t.startAt,e.startAt)&&oo(t.endAt,e.endAt)}function Gi(t){return Ei.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var zi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(Mr.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Qi(t,n,r):"array-contains"===n?new Xi(t,r):"in"===n?new Ji(t,r):"not-in"===n?new $i(t,r):"array-contains-any"===n?new Zi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Hi(t,n):new Wi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Di(e,this.value)):null!==e&&Oi(this.value)===Oi(e)&&this.m(Di(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Wr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Qi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Ei.fromName(r.referenceValue),i}return Object(Mr.c)(e,t),e.prototype.matches=function(t){var e=Ei.comparator(t.key,this.key);return this.m(e)},e}(zi),Hi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Yi(0,n),r}return Object(Mr.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(zi),Wi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Yi(0,n),r}return Object(Mr.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(zi);function Yi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Ei.fromName(t.referenceValue)})}var Xi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(Mr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return ji(e)&&Si(e.arrayValue,this.value)},e}(zi),Ji=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(Mr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Si(this.value.arrayValue,e)},e}(zi),$i=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(Mr.c)(e,t),e.prototype.matches=function(t){if(Si(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Si(this.value.arrayValue,e)},e}(zi),Zi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(Mr.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!ji(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Si(e.value.arrayValue,t)})},e}(zi),to=function(t,e){this.position=t,this.before=e};function eo(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Ai(t)}).join(",")}var no=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function ro(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function io(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Ei.comparator(Ei.fromName(s.referenceValue),n.key):Di(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function oo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!_i(t.position[n],e.position[n]))return!1;return!0}var so=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function ao(t,e,n,r,i,o,s,a){return new so(t,e,n,r,i,o,s,a)}function uo(t){return new so(t)}function co(t){return!wi(t.limit)&&"F"===t.limitType}function ho(t){return!wi(t.limit)&&"L"===t.limitType}function lo(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function fo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function po(t){return null!==t.collectionGroup}function yo(t){var e=Xr(t);if(null===e.p){e.p=[];var n=fo(e),r=lo(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new no(n)),e.p.push(new no(hi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new no(hi.keyField(),u))}}}return e.p}function go(t){var e=Xr(t);if(!e.T)if("F"===e.limitType)e.T=Vi(e.path,e.collectionGroup,yo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=yo(e);r<i.length;r++){var o=i[r];n.push(new no(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new to(e.endAt.position,!e.endAt.before):null,a=e.startAt?new to(e.startAt.position,!e.startAt.before):null;e.T=Vi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function mo(t,e,n){return new so(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function vo(t,e){return Ki(go(t),go(e))&&t.limitType===e.limitType}function bo(t){return Bi(go(t))+"|lt:"+t.limitType}function wo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Ai(e.value);var e}).join(", ")+"]"),wi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+eo(t.startAt)),t.endAt&&(e+=", endAt: "+eo(t.endAt)),"Target("+e+")"}(go(t))+"; limitType="+t.limitType+")"}function To(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ei.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!io(t.startAt,yo(t),e)||t.endAt&&io(t.endAt,yo(t),e))}(t,e)}function Io(t){return function(e,n){for(var r=!1,i=0,o=yo(t);i<o.length;i++){var s=o[i],a=Eo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Eo(t,e,n){var r=t.field.isKeyField()?Ei.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Di(r,i):Wr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Wr()}}function Oo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ti(e)?"-0":e}}function _o(t){return{integerValue:""+t}}function So(t,e){return Ii(e)?_o(e):Oo(t,e)}var Do=function(){this._=void 0};function ko(t,e,n){return t instanceof xo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Co?jo(t,e):t instanceof Ro?Uo(t,e):function(t,e){var n=No(t,e),r=Lo(n)+Lo(t.A);return Ci(n)&&Ci(t.A)?_o(r):Oo(t.R,r)}(t,e)}function Ao(t,e,n){return t instanceof Co?jo(t,e):t instanceof Ro?Uo(t,e):n}function No(t,e){return t instanceof Po?Ci(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var xo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Mr.c)(e,t),e}(Do),Co=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Mr.c)(e,t),e}(Do);function jo(t,e){for(var n=Mo(e),r=function(t){n.some(function(e){return _i(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Ro=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(Mr.c)(e,t),e}(Do);function Uo(t,e){for(var n=Mo(e),r=function(t){n=n.filter(function(e){return!_i(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Po=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(Mr.c)(e,t),e}(Do);function Lo(t){return yi(t.integerValue||t.doubleValue)}function Mo(t){return ji(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Fo=function(t,e){this.field=t,this.transform=e},qo=function(t,e){this.version=t,this.transformResults=e},Vo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Bo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Ko=function(){};function Go(t,e,n){t instanceof Yo?function(t,e,n){var r=t.value.clone(),i=$o(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Xo?function(t,e,n){if(Bo(t.precondition,e)){var r=$o(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Jo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function zo(t,e,n){t instanceof Yo?function(t,e,n){if(Bo(t.precondition,e)){var r=t.value.clone(),i=Zo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Wo(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Xo?function(t,e,n){if(Bo(t.precondition,e)){var r=Zo(t.fieldTransforms,n,e),i=e.data;i.setAll(Jo(t)),i.setAll(r),e.convertToFoundDocument(Wo(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Bo(t.precondition,e)&&e.convertToNoDocument(ri.min())}(t,e)}function Qo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=No(o.transform,s||null);null!=a&&(null==n&&(n=Li.empty()),n.set(o.field,a))}return n||null}function Ho(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ti(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Co&&e instanceof Co||t instanceof Ro&&e instanceof Ro?ti(t.elements,e.elements,_i):t instanceof Po&&e instanceof Po?_i(t.A,e.A):t instanceof xo&&e instanceof xo}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Wo(t){return t.isFoundDocument()?t.version:ri.min()}var Yo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(Mr.c)(e,t),e}(Ko),Xo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(Mr.c)(e,t),e}(Ko);function Jo(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function $o(t,e,n){var r=new Map;Yr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Ao(s,a,n[i]))}return r}function Zo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,ko(a,u,e))}return r}var ts,es,ns=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(Mr.c)(e,t),e}(Ko),rs=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(Mr.c)(e,t),e}(Ko),is=function(t){this.count=t};function os(t){switch(t){case qr.OK:return Wr();case qr.CANCELLED:case qr.UNKNOWN:case qr.DEADLINE_EXCEEDED:case qr.RESOURCE_EXHAUSTED:case qr.INTERNAL:case qr.UNAVAILABLE:case qr.UNAUTHENTICATED:return!1;case qr.INVALID_ARGUMENT:case qr.NOT_FOUND:case qr.ALREADY_EXISTS:case qr.PERMISSION_DENIED:case qr.FAILED_PRECONDITION:case qr.ABORTED:case qr.OUT_OF_RANGE:case qr.UNIMPLEMENTED:case qr.DATA_LOSS:return!0;default:return Wr()}}function ss(t){if(void 0===t)return zr("GRPC error has no .code"),qr.UNKNOWN;switch(t){case ts.OK:return qr.OK;case ts.CANCELLED:return qr.CANCELLED;case ts.UNKNOWN:return qr.UNKNOWN;case ts.DEADLINE_EXCEEDED:return qr.DEADLINE_EXCEEDED;case ts.RESOURCE_EXHAUSTED:return qr.RESOURCE_EXHAUSTED;case ts.INTERNAL:return qr.INTERNAL;case ts.UNAVAILABLE:return qr.UNAVAILABLE;case ts.UNAUTHENTICATED:return qr.UNAUTHENTICATED;case ts.INVALID_ARGUMENT:return qr.INVALID_ARGUMENT;case ts.NOT_FOUND:return qr.NOT_FOUND;case ts.ALREADY_EXISTS:return qr.ALREADY_EXISTS;case ts.PERMISSION_DENIED:return qr.PERMISSION_DENIED;case ts.FAILED_PRECONDITION:return qr.FAILED_PRECONDITION;case ts.ABORTED:return qr.ABORTED;case ts.OUT_OF_RANGE:return qr.OUT_OF_RANGE;case ts.UNIMPLEMENTED:return qr.UNIMPLEMENTED;case ts.DATA_LOSS:return qr.DATA_LOSS;default:return Wr()}}(es=ts||(ts={}))[es.OK=0]="OK",es[es.CANCELLED=1]="CANCELLED",es[es.UNKNOWN=2]="UNKNOWN",es[es.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",es[es.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",es[es.NOT_FOUND=5]="NOT_FOUND",es[es.ALREADY_EXISTS=6]="ALREADY_EXISTS",es[es.PERMISSION_DENIED=7]="PERMISSION_DENIED",es[es.UNAUTHENTICATED=16]="UNAUTHENTICATED",es[es.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",es[es.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",es[es.ABORTED=10]="ABORTED",es[es.OUT_OF_RANGE=11]="OUT_OF_RANGE",es[es.UNIMPLEMENTED=12]="UNIMPLEMENTED",es[es.INTERNAL=13]="INTERNAL",es[es.UNAVAILABLE=14]="UNAVAILABLE",es[es.DATA_LOSS=15]="DATA_LOSS";var as=function(){function t(t,e){this.comparator=t,this.root=e||cs.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,cs.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,cs.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new us(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new us(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new us(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new us(this.root,t,this.comparator,!0)},t}(),us=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),cs=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Wr();if(this.right.isRed())throw Wr();var t=this.left.check();if(t!==this.right.check())throw Wr();return t+(this.isRed()?0:1)},t}();cs.EMPTY=null,cs.RED=!0,cs.BLACK=!1,cs.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Wr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new cs(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var hs=function(){function t(t){this.comparator=t,this.data=new as(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new ls(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new ls(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),ls=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),fs=new as(Ei.comparator);function ds(){return fs}var ps=new as(Ei.comparator);function ys(){return ps}var gs=new as(Ei.comparator);function ms(){return gs}var vs=new hs(Ei.comparator);function bs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=vs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var ws=new hs(Zr);function Ts(){return ws}var Is=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Es.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(ri.min(),r,Ts(),ds(),bs())},t}(),Es=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(fi.EMPTY_BYTE_STRING,n,bs(),bs(),bs())},t}(),Os=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},_s=function(t,e){this.targetId=t,this.V=e},Ss=function(t,e,n,r){void 0===n&&(n=fi.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Ds=function(){function t(){this.S=0,this.D=Ns(),this.C=fi.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=bs(),e=bs(),n=bs();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Wr()}}),new Es(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Ns()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),ks=function(){function t(t){this.W=t,this.G=new Map,this.H=ds(),this.J=As(),this.Y=new hs(Zr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:Wr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Gi(i))if(0===n){var o=new Ei(i.path);this.tt(e,o,Fi.newNoDocument(o,ri.min()))}else Yr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Gi(o.target)){var s=new Ei(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Fi.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}});var r=bs();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Is(t,n,this.Y,this.H,r);return this.H=ds(),this.J=As(),this.Y=new hs(Zr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Ds,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new hs(Zr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Gr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Ds),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function As(){return new as(Ei.comparator)}function Ns(){return new as(Ei.comparator)}var xs={asc:"ASCENDING",desc:"DESCENDING"},Cs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},js=function(t,e){this.databaseId=t,this.I=e};function Rs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Us(t,e){return t.I?e.toBase64():e.toUint8Array()}function Ps(t,e){return Rs(t,e.toTimestamp())}function Ls(t){return Yr(!!t),ri.fromTimestamp(function(t){var e=pi(t);return new ni(e.seconds,e.nanos)}(t))}function Ms(t,e){return function(t){return new ui(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Fs(t){var e=ui.fromString(t);return Yr(ca(e)),e}function qs(t,e){return Ms(t.databaseId,e.path)}function Vs(t,e){var n=Fs(e);if(n.get(1)!==t.databaseId.projectId)throw new Vr(qr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Vr(qr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ei(zs(n))}function Bs(t,e){return Ms(t.databaseId,e)}function Ks(t){var e=Fs(t);return 4===e.length?ui.emptyPath():zs(e)}function Gs(t){return new ui(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function zs(t){return Yr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Qs(t,e,n){return{name:qs(t,e),fields:n.toProto().mapValue.fields}}function Hs(t,e,n){var r=Vs(t,e.name),i=Ls(e.updateTime),o=new Li({mapValue:{fields:e.fields}}),s=Fi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Ws(t,e){var n;if(e instanceof Yo)n={update:Qs(t,e.key,e.value)};else if(e instanceof ns)n={delete:qs(t,e.key)};else if(e instanceof Xo)n={update:Qs(t,e.key,e.data),updateMask:ua(e.fieldMask)};else{if(!(e instanceof rs))return Wr();n={verify:qs(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof xo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Co)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ro)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Po)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Wr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ps(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Wr()}(t,e.precondition)),n}function Ys(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Vo.updateTime(Ls(t.updateTime)):void 0!==t.exists?Vo.exists(t.exists):Vo.none()}(e.currentDocument):Vo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Yr("REQUEST_TIME"===e.setToServerValue),n=new xo):"appendMissingElements"in e?n=new Co(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new Ro(e.removeAllFromArray.values||[]):"increment"in e?n=new Po(t,e.increment):Wr();var r=hi.fromServerFormat(e.fieldPath);return new Fo(r,n)}(t,e)}):[];if(e.update){var i=Vs(t,e.update.name),o=new Li({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new li((t.fieldPaths||[]).map(function(t){return hi.fromServerFormat(t)}))}(e.updateMask);return new Xo(i,o,s,n,r)}return new Yo(i,o,n,r)}if(e.delete){var a=Vs(t,e.delete);return new ns(a,n)}if(e.verify){var u=Vs(t,e.verify);return new rs(u,n)}return Wr()}function Xs(t,e){return{documents:[Bs(t,e.path)]}}function Js(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Bs(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Bs(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(Ui(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NAN"}};if(Ri(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ui(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NOT_NAN"}};if(Ri(t.value))return{unaryFilter:{field:ia(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ia(t.field),op:ra(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:ia(t.field),direction:na(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||wi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=ta(e.startAt)),e.endAt&&(n.structuredQuery.endAt=ta(e.endAt)),n}function $s(t){var e=Ks(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Yr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Zs(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new no(oa(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return wi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ea(n.startAt));var h=null;return n.endAt&&(h=ea(n.endAt)),ao(e,i,a,s,u,"F",c,h)}function Zs(t){return t?void 0!==t.unaryFilter?[aa(t)]:void 0!==t.fieldFilter?[sa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Zs(t)}).reduce(function(t,e){return t.concat(e)}):Wr():[]}function ta(t){return{before:t.before,values:t.position}}function ea(t){return new to(t.values||[],!!t.before)}function na(t){return xs[t]}function ra(t){return Cs[t]}function ia(t){return{fieldPath:t.canonicalString()}}function oa(t){return hi.fromServerFormat(t.fieldPath)}function sa(t){return zi.create(oa(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Wr()}}(t.fieldFilter.op),t.fieldFilter.value)}function aa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=oa(t.unaryFilter.field);return zi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=oa(t.unaryFilter.field);return zi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=oa(t.unaryFilter.field);return zi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=oa(t.unaryFilter.field);return zi.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Wr()}}function ua(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function ca(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ha(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=fa(e)),e=la(t.get(n),e);return fa(e)}function la(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function fa(t){return t+"\x01\x01"}function da(t){var e=t.length;if(Yr(e>=2),2===e)return Yr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),ui.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Wr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Wr()}o=s+2}return new ui(r)}var pa=function(t,e){this.seconds=t,this.nanoseconds=e},ya=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};ya.store="owner",ya.key="owner";var ga=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};ga.store="mutationQueues",ga.keyPath="userId";var ma=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ma.store="mutations",ma.keyPath="batchId",ma.userMutationsIndex="userMutationsIndex",ma.userMutationsKeyPath=["userId","batchId"];var va=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ha(e)]},t.key=function(t,e,n){return[t,ha(e),n]},t}();va.store="documentMutations",va.PLACEHOLDER=new va;var ba=function(t,e){this.path=t,this.readTime=e},wa=function(t,e){this.path=t,this.version=e},Ta=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ta.store="remoteDocuments",Ta.readTimeIndex="readTimeIndex",Ta.readTimeIndexPath="readTime",Ta.collectionReadTimeIndex="collectionReadTimeIndex",Ta.collectionReadTimeIndexPath=["parentPath","readTime"];var Ia=function(t){this.byteSize=t};Ia.store="remoteDocumentGlobal",Ia.key="remoteDocumentGlobalKey";var Ea=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ea.store="targets",Ea.keyPath="targetId",Ea.queryTargetsIndexName="queryTargetsIndex",Ea.queryTargetsKeyPath=["canonicalId","targetId"];var Oa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Oa.store="targetDocuments",Oa.keyPath=["targetId","path"],Oa.documentTargetsIndex="documentTargetsIndex",Oa.documentTargetsKeyPath=["path","targetId"];var _a=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};_a.key="targetGlobalKey",_a.store="targetGlobal";var Sa=function(t,e){this.collectionId=t,this.parent=e};Sa.store="collectionParents",Sa.keyPath=["collectionId","parent"];var Da=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Da.store="clientMetadata",Da.keyPath="clientId";var ka=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ka.store="bundles",ka.keyPath="bundleId";var Aa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Aa.store="namedQueries",Aa.keyPath="name";var Na=Object(Mr.f)(Object(Mr.f)([],Object(Mr.f)(Object(Mr.f)([],Object(Mr.f)(Object(Mr.f)([],Object(Mr.f)(Object(Mr.f)([],[ga.store,ma.store,va.store,Ta.store,Ea.store,ya.store,_a.store,Oa.store]),[Da.store])),[Ia.store])),[Sa.store])),[ka.store,Aa.store]),xa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ca=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),ja=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Ra=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Wr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Ua=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new ja,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ma(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Ka(e.target.error);n.ft.reject(new Ma(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Ma(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Gr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new qa(e)},t}(),Pa=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(R.i)())&&zr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Gr("SimpleDb","Removing database:",t),Va(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(R.i)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(Mr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Gr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Ma(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Vr(qr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Ma(t,n))},i.onupgradeneeded=function(t){Gr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Gr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(Mr.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(Mr.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(Mr.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Ua.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),Ra.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Gr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),La=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Va(this.Pt.delete())},t}(),Ma=function(t){function e(e,n){var r=this;return(r=t.call(this,qr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(Mr.c)(e,t),e}(Vr);function Fa(t){return"IndexedDbTransactionError"===t.name}var qa=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Gr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Gr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Va(n)},t.prototype.add=function(t){return Gr("SimpleDb","ADD",this.store.name,t,t),Va(this.store.add(t))},t.prototype.get=function(t){var e=this;return Va(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Gr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Gr("SimpleDb","DELETE",this.store.name,t),Va(this.store.delete(t))},t.prototype.count=function(){return Gr("SimpleDb","COUNT",this.store.name),Va(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Gr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new Ra(function(n,r){e.onerror=function(t){var e=Ka(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new Ra(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new La(i),s=e(i.primaryKey,i.value,o);if(s instanceof Ra){var a=s.catch(function(t){return o.done(),Ra.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return Ra.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Va(t){return new Ra(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Ka(t.target.error);n(e)}})}var Ba=!1;function Ka(t){var e=Pa._t(Object(R.i)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Vr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ba||(Ba=!0,setTimeout(function(){throw r},0)),r}}return t}var Ga=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(Mr.c)(e,t),e}(Ca);function za(t,e){var n=Xr(t);return Pa.It(n.Mt,e)}var Qa=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Go(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&zo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&zo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(ri.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},bs())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&ti(this.mutations,t.mutations,function(t,e){return Ho(t,e)})&&ti(this.baseMutations,t.baseMutations,function(t,e){return Ho(t,e)})},t}(),Ha=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Yr(e.mutations.length===r.length);for(var i=ms(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Wa=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=ri.min()),void 0===o&&(o=ri.min()),void 0===s&&(s=fi.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ya=function(t){this.Lt=t};function Xa(t,e){if(e.document)return Hs(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ei.fromSegments(e.noDocument.path),r=eu(e.noDocument.readTime),i=Fi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Ei.fromSegments(e.unknownDocument.path);return r=eu(e.unknownDocument.version),Fi.newUnknownDocument(o,r)}return Wr()}function Ja(t,e,n){var r=$a(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:qs(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:Rs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Ta(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=tu(e.version);return s=e.hasCommittedMutations,new Ta(null,new ba(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=tu(e.version);return new Ta(new wa(c,h),null,null,!0,r,i)}return Wr()}function $a(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Za(t){var e=new ni(t[0],t[1]);return ri.fromTimestamp(e)}function tu(t){var e=t.toTimestamp();return new pa(e.seconds,e.nanoseconds)}function eu(t){var e=new ni(t.seconds,t.nanoseconds);return ri.fromTimestamp(e)}function nu(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Ys(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Ys(t.Lt,e)}),o=ni.fromMillis(e.localWriteTimeMs);return new Qa(e.batchId,o,n,i)}function ru(t){var e,n,r=eu(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?eu(t.lastLimboFreeSnapshotVersion):ri.min();return void 0!==t.query.documents?(Yr(1===(n=t.query).documents.length),e=go(uo(Ks(n.documents[0])))):e=function(t){return go($s(t))}(t.query),new Wa(e,t.targetId,0,t.lastListenSequenceNumber,r,i,fi.fromBase64String(t.resumeToken))}function iu(t,e){var n,r=tu(e.snapshotVersion),i=tu(e.lastLimboFreeSnapshotVersion);n=Gi(e.target)?Xs(t.Lt,e.target):Js(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Ea(e.targetId,Bi(e.target),r,o,e.sequenceNumber,i,n)}function ou(t){var e=$s({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?mo(e,e.limit,"L"):e}var su=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return au(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:eu(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return au(t).put({bundleId:(n=e).id,createTime:tu(Ls(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return uu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:ou(e.bundledQuery),readTime:eu(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return uu(t).put(function(t){return{name:t.name,readTime:tu(Ls(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function au(t){return za(t,ka.store)}function uu(t){return za(t,Aa.store)}var cu=function(){function t(){this.Bt=new hu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Ra.resolve()},t.prototype.getCollectionParents=function(t,e){return Ra.resolve(this.Bt.getEntries(e))},t}(),hu=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new hs(ui.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new hs(ui.comparator)).toArray()},t}(),lu=function(){function t(){this.qt=new hu}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:ha(i)};return fu(t).put(o)}return Ra.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[ei(e),""],!1,!0);return fu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(da(o.parent))}return n})},t}();function fu(t){return za(t,Sa.store)}var du={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},pu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function yu(t,e,n){var r=t.store(ma.store),i=t.store(va.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Yr(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=va.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return Ra.waitFor(o).next(function(){return c})}function gu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Wr();e=t.noDocument}return JSON.stringify(e).length}pu.DEFAULT_COLLECTION_PERCENTILE=10,pu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pu.DEFAULT=new pu(41943040,pu.DEFAULT_COLLECTION_PERCENTILE,pu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pu.DISABLED=new pu(-1,0,0);var mu=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Yr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bu(t).Ot({index:ma.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=wu(t),s=bu(t);return s.add({}).next(function(a){Yr("number"==typeof a);for(var u=new Qa(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Ws(t.Lt,e)}),i=n.mutations.map(function(e){return Ws(t.Lt,e)});return new ma(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new hs(function(t,e){return Zr(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=va.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,va.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[a]=u.keys()}),Ra.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return bu(t).get(e).next(function(t){return t?(Yr(t.userId===n.userId),nu(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?Ra.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return bu(t).Ot({index:ma.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Yr(e.batchId>=r),o=nu(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return bu(t).Ot({index:ma.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bu(t).Nt(ma.userMutationsIndex,n).next(function(t){return t.map(function(t){return nu(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=va.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return wu(t).Ot({range:i},function(r,i,s){var a=r[0],u=r[2],c=da(r[1]);if(a===n.userId&&e.path.isEqual(c))return bu(t).get(u).next(function(t){if(!t)throw Wr();Yr(t.userId===n.userId),o.push(nu(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new hs(Zr),i=[];return e.forEach(function(e){var o=va.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=wu(t).Ot({range:s},function(t,i,o){var s=t[0],a=t[2],u=da(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),Ra.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=va.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new hs(Zr);return wu(t).Ot({range:s},function(t,e,o){var s=t[0],u=t[2],c=da(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(bu(t).get(e).next(function(t){if(null===t)throw Wr();Yr(t.userId===n.userId),r.push(nu(n.R,t))}))}),Ra.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return yu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),Ra.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Ra.resolve();var r=IDBKeyRange.lowerBound(va.prefixForUser(e.userId)),i=[];return wu(t).Ot({range:r},function(t,n,r){if(t[0]===e.userId){var o=da(t[1]);i.push(o)}else r.done()}).next(function(){Yr(0===i.length)})})},t.prototype.containsKey=function(t,e){return vu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Tu(t).get(this.userId).next(function(t){return t||new ga(e.userId,-1,"")})},t}();function vu(t,e,n){var r=va.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return wu(t).Ot({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function bu(t){return za(t,ma.store)}function wu(t){return za(t,va.store)}function Tu(t){return za(t,ga.store)}var Iu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Eu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Iu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return ri.fromTimestamp(new ni(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Ou(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Yr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Ou(t).Ot(function(s,a){var u=ru(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return Ra.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return Ou(t).Ot(function(t,n){var r=ru(n);e(r)})},t.prototype.Xt=function(t){return _u(t).get(_a.key).next(function(t){return Yr(null!==t),t})},t.prototype.Zt=function(t,e){return _u(t).put(_a.key,e)},t.prototype.te=function(t,e){return Ou(t).put(iu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Bi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Ou(t).Ot({range:r,index:Ea.queryTargetsIndexName},function(t,n,r){var o=ru(n);Ki(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Su(t);return e.forEach(function(e){var s=ha(e.path);i.push(o.put(new Oa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),Ra.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Su(t);return Ra.forEach(e,function(e){var o=ha(e.path);return Ra.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Su(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Su(t),i=bs();return r.Ot({range:n,kt:!0},function(t,e,n){var r=da(t[1]),o=new Ei(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=ha(e.path),r=IDBKeyRange.bound([n],[ei(n)],!1,!0),i=0;return Su(t).Ot({index:Oa.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return Ou(t).get(e).next(function(t){return t?ru(t):null})},t}();function Ou(t){return za(t,Ea.store)}function _u(t){return za(t,_a.store)}function Su(t){return za(t,Oa.store)}function Du(t){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(e){if(t.code!==qr.FAILED_PRECONDITION||t.message!==xa)throw t;return Gr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function ku(t,e){var n=t[1],r=e[1],i=Zr(t[0],e[0]);return 0===i?Zr(n,r):i}var Au=function(){function t(t){this.ne=t,this.buffer=new hs(ku),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ku(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Nu=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Gr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(Mr.b)(e,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Fa(e=n.sent())?(Gr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Du(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),xu=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Ra.resolve(Fr.o);var r=new Au(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Gr("LruGarbageCollector","Garbage collection skipped; disabled"),Ra.resolve(du)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Gr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),du):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Gr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Kr()<=U.a.DEBUG&&Gr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Ra.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Cu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new xu(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return ju(t,n)},t.prototype.removeReference=function(t,e,n){return ju(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return ju(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Tu(t).$t(function(r){return vu(t,r,e).next(function(t){return t&&(n=!0),Ra.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Su(t).delete([0,ha(s.path)])})});i.push(u)}}).next(function(){return Ra.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return ju(t,e)},t.prototype.we=function(t,e){var n,r=Su(t),i=Fr.o;return r.Ot({index:Oa.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Fr.o&&e(new Ei(da(n)),i),i=s,n=o):i=Fr.o}).next(function(){i!==Fr.o&&e(new Ei(da(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function ju(t,e){return Su(t).put(function(t,e){return new Oa(0,ha(t.path),e)}(e,t.currentSequenceNumber))}var Ru=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){oi(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return si(this.inner)},t}(),Uu=function(){function t(){this.changes=new Ru(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:ri.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Fi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Ra.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),Pu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Fu(t).put(qu(e),n)},t.prototype.removeEntry=function(t,e){var n=Fu(t),r=qu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Fu(t).get(qu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Fu(t).get(qu(e)).next(function(t){return{document:n.ye(e,t),size:gu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=ds();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=ds(),i=new as(Ei.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,gu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Ra.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Fu(t).Ot({range:r},function(t,e,r){for(var s=Ei.fromSegments(t);o&&Ei.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=ds(),o=e.path.length+1,s={};if(n.isEqual(ri.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=$a(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Ta.collectionReadTimeIndex}return Fu(t).Ot(s,function(t,n,s){if(t.length===o){var a=Xa(r.R,n);e.path.isPrefixOf(a.key.path)?To(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Lu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Mu(t).get(Ia.key).next(function(t){return Yr(!!t),t})},t.prototype.me=function(t,e){return Mu(t).put(Ia.key,e)},t.prototype.ye=function(t,e){if(e){var n=Xa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(ri.min()))return n}return Fi.newInvalidDocument(t)},t}(),Lu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Ru(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(Mr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new hs(function(t,e){return Zr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Ja(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=gu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Ja(e.Ie.R,Fi.newNoDocument(o,ri.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),Ra.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Uu);function Mu(t){return za(t,Ia.store)}function Fu(t){return za(t,Ta.store)}function qu(t){return t.path.toArray()}var Vu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Yr(n<r&&n>=0&&r<=11);var o=new Ua("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(ya.store)}(t),function(t){t.createObjectStore(ga.store,{keyPath:ga.keyPath}),t.createObjectStore(ma.store,{keyPath:ma.keyPath,autoIncrement:!0}).createIndex(ma.userMutationsIndex,ma.userMutationsKeyPath,{unique:!0}),t.createObjectStore(va.store)}(t),Bu(t),function(t){t.createObjectStore(Ta.store)}(t));var s=Ra.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Oa.store),t.deleteObjectStore(Ea.store),t.deleteObjectStore(_a.store)}(t),Bu(t)),s=s.next(function(){return function(t){var e=t.store(_a.store),n=new _a(0,0,ri.min().toTimestamp(),0);return e.put(_a.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(ma.store).Nt().next(function(n){t.deleteObjectStore(ma.store),t.createObjectStore(ma.store,{keyPath:ma.keyPath,autoIncrement:!0}).createIndex(ma.userMutationsIndex,ma.userMutationsKeyPath,{unique:!0});var r=e.store(ma.store),i=n.map(function(t){return r.put(t)});return Ra.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Da.store,{keyPath:Da.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Ia.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Ta.store);e.createIndex(Ta.readTimeIndex,Ta.readTimeIndexPath,{unique:!1}),e.createIndex(Ta.collectionReadTimeIndex,Ta.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(ka.store,{keyPath:ka.keyPath})}(t),function(t){t.createObjectStore(Aa.store,{keyPath:Aa.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(Ta.store).Ot(function(t,n){e+=gu(n)}).next(function(){var n=new Ia(e);return t.store(Ia.store).put(Ia.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(ga.store),r=t.store(ma.store);return n.Nt().next(function(n){return Ra.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(ma.userMutationsIndex,i).next(function(r){return Ra.forEach(r,function(r){Yr(r.userId===n.userId);var i=nu(e.R,r);return yu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(Oa.store),n=t.store(Ta.store);return t.store(_a.store).get(_a.key).next(function(t){var r=[];return n.Ot(function(n,i){var o=new ui(n),s=function(t){return[0,ha(t)]}(o);r.push(e.get(s).next(function(n){return n?Ra.resolve():function(n){return e.put(new Oa(0,ha(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return Ra.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Sa.store,{keyPath:Sa.keyPath});var n=e.store(Sa.store),r=new hu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ha(i)})}};return e.store(Ta.store).Ot({kt:!0},function(t,e){var n=new ui(t);return i(n.popLast())}).next(function(){return e.store(va.store).Ot({kt:!0},function(t,e){var n=da(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Ea.store);return n.Ot(function(t,r){var i=ru(r),o=iu(e.R,i);return n.put(o)})},t}();function Bu(t){t.createObjectStore(Oa.store,{keyPath:Oa.keyPath}).createIndex(Oa.documentTargetsIndex,Oa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ea.store,{keyPath:Ea.keyPath}).createIndex(Ea.queryTargetsIndexName,Ea.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(_a.store)}var Ku="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Gu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Vr(qr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Cu(this,i),this.Le=n+"main",this.R=new Ya(u),this.Be=new Pa(this.Le,11,new Vu(this.R)),this.qe=new Eu(this.referenceDelegate,this.R),this.Ut=new lu,this.Ue=function(t,e){return new Pu(t,e)}(this.R,this.Ut),this.Qe=new su,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&zr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Vr(qr.FAILED_PRECONDITION,Ku);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Fr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(Mr.b)(e,void 0,void 0,function(){return Object(Mr.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(Mr.b)(e,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(Mr.b)(e,void 0,void 0,function(){return Object(Mr.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Qu(e).put(new Da(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Fa(e))return Gr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Gr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return zu(t).get(ya.key).next(function(t){return Ra.resolve(e.tn(t))})},t.prototype.en=function(t){return Qu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=za(t,Da.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return Ra.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Ra.resolve(!0):zu(t).get(ya.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Vr(qr.FAILED_PRECONDITION,Ku);return!1}}return!(!e.networkEnabled||!e.inForeground)||Qu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Gr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t=this;return Object(Mr.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[ya.store,Da.store],function(e){var n=new Ga(e,Fr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Qu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return mu.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Gr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Na,function(o){return r=new Ga(o,i.Ne?i.Ne.next():Fr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw zr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Vr(qr.FAILED_PRECONDITION,xa);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return zu(t).get(ya.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Vr(qr.FAILED_PRECONDITION,Ku)})},t.prototype.Ze=function(t){var e=new ya(this.clientId,this.allowTabSynchronization,Date.now());return zu(t).put(ya.key,e)},t.yt=function(){return Pa.yt()},t.prototype.Xe=function(t){var e=this,n=zu(t);return n.get(ya.key).next(function(t){return e.tn(t)?(Gr("IndexedDbPersistence","Releasing primary lease."),n.delete(ya.key)):Ra.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(zr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Gr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return zr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){zr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function zu(t){return za(t,ya.store)}function Qu(t){return za(t,Da.store)}function Hu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Wu=function(t,e){this.progress=t,this.wn=e},Yu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Ei.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):po(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Ei(e)).next(function(t){var e=ys();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=ys();return this.Ut.getCollectionParents(t,i).next(function(s){return Ra.forEach(s,function(s){var a=function(t,e){return new so(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Fi.newInvalidDocument(c),r=r.insert(c,h)),zo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){To(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=bs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Xo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),Xu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=bs(),i=bs(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Ju=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(ri.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(co(e)||ho(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Kr()<=U.a.DEBUG&&Gr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),wo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new hs(Io(t));return e.forEach(function(e,r){To(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Kr()<=U.a.DEBUG&&Gr("QueryEngine","Using full collection scan to execute query:",wo(e)),this.Sn.getDocumentsMatchingQuery(t,e,ri.min())},t}(),$u=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new as(Zr),this.kn=new Ru(function(t){return Bi(t)},Ki),this.On=ri.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Yu(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Zu(t,e,n,r){return new $u(t,e,n,r)}function tc(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Mr.d)(this,function(s){switch(s.label){case 0:return n=Xr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Yu(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=bs(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,g=p.mutations;y<g.length;y++)s=s.add(g[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function ec(t,e){var n=Xr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Ra.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Yr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function nc(t){var e=Xr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function rc(t,e){var n=Xr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Yr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=ds();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(ic(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(ri.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return Ra.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function ic(t,e,n,r,i){var o=bs();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=ds();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(ri.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Gr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function oc(t,e){var n=Xr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function sc(t,e){var n=Xr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?Ra.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Wa(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function ac(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Mr.d)(this,function(a){switch(a.label){case 0:r=Xr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Fa(s=a.sent()))throw s;return Gr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function uc(t,e,n){var r=Xr(t),i=ri.min(),o=bs();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Xr(t),i=r.kn.get(n);return void 0!==i?Ra.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,go(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:ri.min(),n?o:bs())}).next(function(t){return{documents:t,Bn:o}})})}function cc(t,e){var n=Xr(t),r=Xr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function hc(t){var e=Xr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Xr(t),i=ds(),o=$a(n),s=Fu(e),a=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:Ta.readTimeIndex,range:a},function(t,e){var n=Xa(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Za(o)}})}(e.$n,t,e.On)}).then(function(t){var n=t.wn;return e.On=t.readTime,n})}function lc(t){return Object(Mr.b)(this,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){return[2,(e=Xr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Fu(t),n=ri.min();return e.Ot({index:Ta.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Za(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.On=t})]})})}function fc(t,e,n,r){return Object(Mr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(Mr.d)(this,function(p){switch(p.label){case 0:for(i=Xr(t),o=bs(),s=ds(),a=ms(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.$n.newChangeBuffer({trackRemovals:!0}),[4,sc(i,function(t){return go(uo(ui.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return ic(t,f,s,ri.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function dc(t,e,n){return void 0===n&&(n=bs()),Object(Mr.b)(this,void 0,void 0,function(){var r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return[4,sc(t,go(ou(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Xr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Ls(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(fi.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}var pc=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Ra.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:Ls(n.createTime)}),Ra.resolve()},t.prototype.getNamedQuery=function(t,e){return Ra.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:ou(t.bundledQuery),readTime:Ls(t.readTime)}}(e)),Ra.resolve()},t}(),yc=function(){function t(){this.Wn=new hs(gc.Gn),this.zn=new hs(gc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new gc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new gc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Ei(new ui([])),r=new gc(n,t),i=new gc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Ei(new ui([])),n=new gc(e,t),r=new gc(e,t+1),i=bs();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new gc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),gc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Ei.comparator(t.key,e.key)||Zr(t.ns,e.ns)},t.Hn=function(t,e){return Zr(t.ns,e.ns)||Ei.comparator(t.key,e.key)},t}(),mc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new hs(gc.Gn)}return t.prototype.checkEmpty=function(t){return Ra.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Qa(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new gc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return Ra.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Ra.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Ra.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Ra.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Ra.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new gc(e,0),i=new gc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),Ra.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new hs(Zr);return e.forEach(function(t){var e=new gc(t,0),i=new gc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),Ra.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Ei.isDocumentKey(i)||(i=i.child(""));var o=new gc(new Ei(i),0),s=new hs(Zr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),Ra.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Yr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Ra.forEach(e.mutations,function(i){var o=new gc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new gc(e,0),r=this.rs.firstAfterOrEqual(n);return Ra.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Ra.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),vc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new as(Ei.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Ra.resolve(n?n.document.clone():Fi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=ds();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Fi.newInvalidDocument(t))}),Ra.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=ds(),i=new Ei(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||To(e,u)&&(r=r.insert(u.key,u.clone()))}return Ra.resolve(r)},t.prototype.fs=function(t,e){return Ra.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new bc(this)},t.prototype.getSize=function(t){return Ra.resolve(this.size)},t}(),bc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(Mr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),Ra.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Uu),wc=function(){function t(t){this.persistence=t,this.ds=new Ru(function(t){return Bi(t)},Ki),this.lastRemoteSnapshotVersion=ri.min(),this.highestTargetId=0,this.ws=0,this._s=new yc,this.targetCount=0,this.ys=Iu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),Ra.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Ra.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Ra.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Ra.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Ra.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Iu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Ra.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Ra.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Ra.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),Ra.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return Ra.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Ra.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Ra.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),Ra.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Ra.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Ra.resolve(n)},t.prototype.containsKey=function(t,e){return Ra.resolve(this._s.containsKey(e))},t}(),Tc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Fr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new wc(this),this.Ut=new cu,this.Ue=function(t,e){return new vc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Ya(e),this.Qe=new pc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new mc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;Gr("MemoryPersistence","Starting transaction:",t);var i=new Ic(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return Ra.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Ic=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(Mr.c)(e,t),e}(Ca),Ec=function(){function t(t){this.persistence=t,this.As=new yc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Wr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Ra.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Ra.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Ra.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ra.forEach(this.vs,function(r){var i=Ei.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Ra.or([function(){return Ra.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Oc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function _c(t,e){return"firestore_clients_"+t+"_"+e}function Sc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Dc(t,e){return"firestore_targets_"+t+"_"+e}Oc.UNAUTHENTICATED=new Oc(null),Oc.GOOGLE_CREDENTIALS=new Oc("google-credentials-uid"),Oc.FIRST_PARTY=new Oc("first-party-uid");var kc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Vr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(zr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Ac=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Vr(i.error.code,i.error.message)),o?new t(e,i.state,r):(zr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Nc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Ts(),s=0;i&&s<r.activeTargetIds.length;++s)i=Ii(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(zr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),xc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(zr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Cc=function(){function t(){this.activeTargetIds=Ts()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),jc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new as(Zr),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=_c(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Cc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(Mr.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(_c(this.persistenceKey,r)))&&(o=Nc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.Os;u<c.length;u++)this.Fs(c[u]);return this.Os=[],this.window.addEventListener("unload",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Dc(this.persistenceKey,t));if(n){var r=Ac.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Dc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Gr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Gr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Gr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Gr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void zr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(Mr.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(Mr.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Fr.o;if(null!=t)try{var n=JSON.parse(t);Yr("number"==typeof n),e=n}catch(t){zr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Fr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new kc(this.currentUser,t,e,n),i=Sc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Sc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Dc(this.persistenceKey,t),i=new Ac(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Nc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return kc.Vs(new Oc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Ac.Vs(r,e)},t.prototype.js=function(t){return xc.Vs(t)},t.prototype.ii=function(t){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Gr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Ts();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),Rc=function(){function t(){this.li=new Cc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Cc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Uc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),Pc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Gr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Gr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Lc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Mc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Fc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return Object(Mr.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new Lr;s.listenOnce(Rr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case jr.NO_ERROR:var e=s.getResponseJson();Gr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case jr.TIMEOUT:Gr("Connection",'RPC "'+t+'" timed out'),o(new Vr(qr.DEADLINE_EXCEEDED,"Request time out"));break;case jr.HTTP_ERROR:var n=s.getStatus();if(Gr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(qr).indexOf(e)>=0?e:qr.UNKNOWN}(r.status);o(new Vr(a,r.message))}else o(new Vr(qr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Vr(qr.UNAVAILABLE,"Connection failed."));break;default:Wr()}}finally{Gr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new kr,i=Ne(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(o.initMessageHeaders,e),Object(R.n)()||Object(R.p)()||Object(R.l)()||Object(R.m)()||Object(R.q)()||Object(R.k)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Gr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Mc({Ei:function(t){c?Gr("Connection","Not sending because WebChannel is closed:",t):(u||(Gr("Connection","Opening WebChannel transport."),a.open(),u=!0),Gr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Pr.EventType.OPEN,function(){c||Gr("Connection","WebChannel transport opened.")}),l(a,Pr.EventType.CLOSE,function(){c||(c=!0,Gr("Connection","WebChannel transport closed"),h.Vi())}),l(a,Pr.EventType.ERROR,function(t){c||(c=!0,Qr("Connection","WebChannel transport errored:",t),h.Vi(new Vr(qr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Pr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Yr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Gr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=ts[t];if(void 0!==e)return ss(e)}(i),s=r.message;void 0===o&&(o=qr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Vr(o,s)),a.close()}else Gr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,Ur.STAT_EVENT,function(t){10===t.stat?Gr("Connection","Detected buffering proxy"):11===t.stat&&Gr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Gr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Gr("RestConnection","Received: ",t),t},function(e){throw Qr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.5.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Lc[t]},t}());function qc(){return"undefined"!=typeof window?window:null}function Vc(){return"undefined"!=typeof document?document:null}function Bc(t){return new js(t,!0)}var Kc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Gr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Gc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Kc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===qr.RESOURCE_EXHAUSTED?(zr(e.toString()),zr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===qr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Vr(qr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(Mr.b)(t,void 0,void 0,function(){return Object(Mr.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Gr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Gr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),zc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(Mr.c)(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Wr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Yr(void 0===e||"string"==typeof e),fi.fromBase64String(e||"")):(Yr(void 0===e||e instanceof Uint8Array),fi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?qr.UNKNOWN:ss(t.code);return new Vr(e,t.message||"")}(a);n=new Ss(r,i,o,s||null)}else if("documentChange"in e){i=Vs(t,(r=e.documentChange).document.name),o=Ls(r.document.updateTime);var a=new Li({mapValue:{fields:r.document.fields}}),u=(s=Fi.newFoundDocument(i,o,a),r.targetIds||[]);n=new Os(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Vs(t,(r=e.documentDelete).document),o=r.readTime?Ls(r.readTime):ri.min(),a=Fi.newNoDocument(i,o),n=new Os([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Vs(t,(r=e.documentRemove).document),n=new Os([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Wr();var c=e.filter;i=new is(r=c.count||0),n=new _s(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return ri.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?ri.min():e.readTime?Ls(e.readTime):ri.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Gs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Gi(r)?{documents:Xs(t,r)}:{query:Js(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Us(t,e.resumeToken):e.snapshotVersion.compareTo(ri.min())>0&&(n.readTime=Rs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Wr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Gs(this.R),e.removeTarget=t,this.cr(e)},e}(Gc),Qc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(Mr.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(Yr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Yr(void 0!==e),t.map(function(t){return function(t,e){var n=Ls(t.updateTime?t.updateTime:e);return n.isEqual(ri.min())&&(n=Ls(e)),new qo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Ls(t.commitTime);return this.listener.Tr(n,e)}return Yr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Gs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ws(e.R,t)})};this.cr(n)},e}(Gc),Hc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(Mr.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new Vr(qr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Vr(qr.UNKNOWN,t.toString())})},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Oi(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===qr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Vr(qr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Wc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(zr(e),this.Vr=!1):Gr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Yc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(Mr.b)(o,void 0,void 0,function(){return Object(Mr.d)(this,function(t){switch(t.label){case 0:return ih(this)?(Gr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(Mr.b)(this,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return(e=Xr(t)).$r.add(4),[4,Jc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,Xc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Wc(n,r)};function Xc(t){return Object(Mr.b)(this,void 0,void 0,function(){var e,n;return Object(Mr.d)(this,function(r){switch(r.label){case 0:if(!ih(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Jc(t){return Object(Mr.b)(this,void 0,void 0,function(){var e,n;return Object(Mr.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function $c(t,e){var n=Xr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),rh(n)?nh(n):bh(n).er()&&th(n,e))}function Zc(t,e){var n=Xr(t),r=bh(n);n.Or.delete(e),r.er()&&eh(n,e),0===n.Or.size&&(r.er()?r.ir():ih(n)&&n.Br.set("Unknown"))}function th(t,e){t.qr.U(e.targetId),bh(t).mr(e)}function eh(t,e){t.qr.U(e),bh(t).yr(e)}function nh(t){t.qr=new ks({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),bh(t).start(),t.Br.Sr()}function rh(t){return ih(t)&&!bh(t).tr()&&t.Or.size>0}function ih(t){return 0===Xr(t).$r.size}function oh(t){t.qr=void 0}function sh(t){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(e){return t.Or.forEach(function(e,n){th(t,e)}),[2]})})}function ah(t,e){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(n){return oh(t),rh(t)?(t.Br.Nr(e),nh(t)):t.Br.set("Unknown"),[2]})})}function uh(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i,o;return Object(Mr.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Ss&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(Mr.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.Or.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Gr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,ch(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Os?t.qr.X(e):e instanceof _s?t.qr.rt(e):t.qr.et(e),n.isEqual(ri.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,nc(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(fi.EMPTY_BYTE_STRING,n.snapshotVersion)),eh(t,e);var r=new Wa(n.target,e,1,n.sequenceNumber);th(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Gr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,ch(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function ch(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r=this;return Object(Mr.d)(this,function(i){switch(i.label){case 0:if(!Fa(e))throw e;return t.$r.add(1),[4,Jc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return nc(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(Mr.b)(r,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return Gr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,Xc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function hh(t,e){return e().catch(function(n){return ch(t,n,e)})}function lh(t){return Object(Mr.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(Mr.d)(this,function(s){switch(s.label){case 0:e=Xr(t),n=wh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return ih(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,oc(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=wh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,ch(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return fh(e)&&dh(e),[2]}})})}function fh(t){return ih(t)&&!wh(t).tr()&&t.kr.length>0}function dh(t){wh(t).start()}function ph(t){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(e){return wh(t).Ar(),[2]})})}function yh(t){return Object(Mr.b)(this,void 0,void 0,function(){var e,n,r;return Object(Mr.d)(this,function(i){for(e=wh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function gh(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Ha.from(r,e,n),[4,hh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,lh(t)];case 2:return o.sent(),[2]}})})}function mh(t,e){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(n){switch(n.label){case 0:return e&&wh(t).pr?[4,function(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return os(r=e.code)&&r!==qr.ABORTED?(n=t.kr.shift(),wh(t).sr(),[4,hh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,lh(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return fh(t)&&dh(t),[2]}})})}function vh(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return n=Xr(t),e?(n.$r.delete(2),[4,Xc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,Jc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function bh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Xr(t);return r.br(),new zc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:sh.bind(null,t),Ri:ah.bind(null,t),_r:uh.bind(null,t)}),t.Mr.push(function(n){return Object(Mr.b)(e,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),rh(t)?nh(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),oh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function wh(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=Xr(t);return r.br(),new Qc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:ph.bind(null,t),Ri:mh.bind(null,t),Ir:yh.bind(null,t),Tr:gh.bind(null,t)}),t.Mr.push(function(n){return Object(Mr.b)(e,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,lh(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(Gr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Qr}var Th=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ja,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Vr(qr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Ih(t,e){if(zr("AsyncQueue",e+": "+t),Fa(t))return new Vr(qr.UNAVAILABLE,e+": "+t);throw t}var Eh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Ei.comparator(e.key,n.key)}:function(t,e){return Ei.comparator(t.key,e.key)},this.keyedMap=ys(),this.sortedSet=new as(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),Oh=function(){function t(){this.Kr=new as(Ei.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Wr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),_h=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Eh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&vo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Sh=function(){this.Wr=void 0,this.listeners=[]},Dh=function(){this.queries=new Ru(function(t){return bo(t)},vo),this.onlineState="Unknown",this.Gr=new Set};function kh(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Mr.d)(this,function(c){switch(c.label){case 0:if(n=Xr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Sh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Ih(a,"Initialization of query '"+wo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Ch(n),[2]}})})}function Ah(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Mr.d)(this,function(a){return n=Xr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Nh(t,e){for(var n=Xr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Ch(n)}function xh(t,e,n){var r=Xr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Ch(t){t.Gr.forEach(function(t){t.next()})}var jh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new _h(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=_h.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),Rh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Uh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Vs(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Hs(this.R,t.document,!1):Fi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return Ls(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Uh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||bs()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return[4,fc(this.localStore,new Uh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,dc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Wu(Object.assign({},this.progress),t))]}})})}}();var Ph=function(t){this.key=t},Lh=function(t){this.key=t},Mh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=bs(),this.mutatedKeys=bs(),this.lo=Io(t),this.fo=new Eh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new Oh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=co(this.query)&&i.size===this.query.limit?i.last():null,c=ho(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=To(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),co(this.query)||ho(this.query))for(;s.size>this.query.limit;){var h=co(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Wr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new _h(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Oh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=bs(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Lh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Ph(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=bs();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return _h.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Fh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},qh=function(t){this.key=t,this.bo=!1},Vh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Ru(function(t){return bo(t)},vo),this.Vo=new Map,this.So=new Set,this.Do=new as(Ei.comparator),this.Co=new Map,this.No=new yc,this.xo={},this.Fo=new Map,this.ko=Iu.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function Bh(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Mr.d)(this,function(a){switch(a.label){case 0:return n=ml(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,sc(n.localStore,go(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Kh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&$c(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Kh(t,e,n,r){return Object(Mr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(Mr.d)(this,function(h){switch(h.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return Object(Mr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Mr.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,uc(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(nl(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,uc(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Mh(e,i.Bn),s=o._o(i.documents),a=Es.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),nl(t,n,u.To),c=new Fh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function Gh(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return n=Xr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!vo(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,ac(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Zc(n.remoteStore,r.targetId),tl(n,r.targetId)}).catch(Du)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return tl(n,r.targetId),[4,ac(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function zh(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Mr.d)(this,function(a){switch(a.label){case 0:r=vl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Xr(t),i=ni.now(),o=e.reduce(function(t,e){return t.add(e.key)},bs());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Qo(c,n.get(c.key));null!=h&&s.push(new Xo(c.key,h,Mi(h.toProto().mapValue),Vo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new as(Zr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,ol(r,i.changes)];case 3:return a.sent(),[4,lh(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Ih(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Qh(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r;return Object(Mr.d)(this,function(i){switch(i.label){case 0:n=Xr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,rc(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Yr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Yr(r.bo):t.removedDocuments.size>0&&(Yr(r.bo),r.bo=!1))}),[4,ol(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Du(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Hh(t,e,n){var r=Xr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Xr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Ch(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Wh(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(Mr.d)(this,function(c){switch(c.label){case 0:return(r=Xr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new as(Ei.comparator)).insert(o,Fi.newNoDocument(o,ri.min())),a=bs().add(o),u=new Is(ri.min(),new Map,new hs(Zr),s,a),[4,Qh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),il(r),[3,4];case 2:return[4,ac(r.localStore,e,!1).then(function(){return tl(r,e,n)}).catch(Du)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function Yh(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:n=Xr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,ec(n.localStore,e)];case 2:return i=o.sent(),Zh(n,r,null),$h(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,ol(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Du(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Xh(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:r=Xr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Xr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Yr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Zh(r,e,n),$h(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,ol(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Du(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Jh(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(Mr.d)(this,function(a){switch(a.label){case 0:ih((n=Xr(t)).remoteStore)||Gr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Xr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=Ih(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function $h(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Zh(t,e,n){var r=Xr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function tl(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||el(t,e)})}function el(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Zc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),il(t))}function nl(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Ph?(t.No.addReference(o.key,e),rl(t,o)):o instanceof Lh?(Gr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||el(t,o.key)):Wr()}}function rl(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Gr("SyncEngine","New document in limbo: "+n),t.So.add(r),il(t))}function il(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ei(ui.fromString(e)),r=t.ko.next();t.Co.set(r,new qh(n)),t.Do=t.Do.insert(n,r),$c(t.remoteStore,new Wa(go(uo(n.path)),r,2,Fr.o))}}function ol(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(Mr.d)(this,function(a){switch(a.label){case 0:return r=Xr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.$o(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Xu.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(Mr.d)(this,function(h){switch(h.label){case 0:n=Xr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return Ra.forEach(e,function(e){return Ra.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return Ra.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!Fa(r=h.sent()))throw r;return Gr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function sl(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return(n=Xr(t)).currentUser.isEqual(e)?[3,3]:(Gr("SyncEngine","User change. New user:",e.toKey()),[4,tc(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Vr(qr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,ol(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function al(t,e){var n=Xr(t),r=n.Co.get(e);if(r&&r.bo)return bs().add(r.key);var i=bs(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function ul(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return[4,uc((n=Xr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&nl(n,e.targetId,i.To),i)]}})})}function cl(t){return Object(Mr.b)(this,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){return[2,hc((e=Xr(t)).localStore).then(function(t){return ol(e,t)})]})})}function hl(t,e,n,r){return Object(Mr.b)(this,void 0,void 0,function(){var i,o;return Object(Mr.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=Xr(t),r=Xr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):Ra.resolve(null)})})}((i=Xr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,lh(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Zh(i,e,r||null),$h(i,e),function(t,e){Xr(Xr(t)._n).Gt(e)}(i.localStore,e)):Wr(),s.label=4;case 4:return[4,ol(i,o)];case 5:return s.sent(),[3,7];case 6:Gr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function ll(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(Mr.d)(this,function(c){switch(c.label){case 0:return ml(n=Xr(t)),vl(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,fl(n,r.toArray())]);case 1:return i=c.sent(),n.Oo=!0,[4,vh(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)$c(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return tl(n,e),ac(n.localStore,e,!0)}),Zc(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,fl(n,a)];case 5:return c.sent(),function(t){var e=Xr(t);e.Co.forEach(function(t,n){Zc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new as(Ei.comparator)}(n),n.Oo=!1,[4,vh(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function fl(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(Mr.d)(this,function(y){switch(y.label){case 0:n=Xr(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,sc(n.localStore,go(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,ul(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,cc(n.localStore,a)];case 8:return p=y.sent(),[4,sc(n.localStore,p)];case 9:return u=y.sent(),[4,Kh(n,dl(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function dl(t){return ao(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function pl(t){var e=Xr(t);return Xr(Xr(e.localStore).persistence).fn()}function yl(t,e,n,r){return Object(Mr.b)(this,void 0,void 0,function(){var i,o,s;return Object(Mr.d)(this,function(a){switch(a.label){case 0:return(i=Xr(t)).Oo?(Gr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,hc(i.localStore)];case 3:return o=a.sent(),s=Is.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,ol(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,ac(i.localStore,e,!0)];case 6:return a.sent(),tl(i,e,r),[3,8];case 7:Wr(),a.label=8;case 8:return[2]}})})}function gl(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(Mr.d)(this,function(f){switch(f.label){case 0:if(!(r=ml(t)).Oo)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Gr("SyncEngine","Adding an already active target "+s),[3,5]):[4,cc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,sc(r.localStore,a)];case 3:return u=f.sent(),[4,Kh(r,dl(a),u.targetId,!1)];case 4:f.sent(),$c(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,ac(r.localStore,t,!1).then(function(){Zc(r.remoteStore,t),tl(r,t)}).catch(Du)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function ml(t){var e=Xr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Qh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=al.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Wh.bind(null,e),e.vo._r=Nh.bind(null,e.eventManager),e.vo.Mo=xh.bind(null,e.eventManager),e}function vl(t){var e=Xr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Yh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Xh.bind(null,e),e}var bl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return this.R=Bc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Zu(this.persistence,new Ju,t.initialUser,this.R)},t.prototype.qo=function(t){return new Tc(Ec.bs,this.R)},t.prototype.Bo=function(t){return new Rc},t.prototype.terminate=function(){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),wl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(Mr.c)(e,t),e.prototype.initialize=function(e){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,lc(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,vl(this.Ko.syncEngine)];case 4:return n.sent(),[4,lh(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){return Zu(this.persistence,new Ju,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Nu(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Hu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?pu.withCacheSize(this.cacheSizeBytes):pu.DEFAULT;return new Gu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,qc(),Vc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Rc},e}(bl),Tl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(Mr.c)(e,t),e.prototype.initialize=function(e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r=this;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof jc?(this.sharedClientState.syncEngine={ui:hl.bind(null,n),ai:yl.bind(null,n),hi:gl.bind(null,n),fn:pl.bind(null,n),ci:cl.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(Mr.b)(r,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return[4,ll(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=qc();if(!jc.yt(e))throw new Vr(qr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Hu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new jc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(wl),Il=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n=this;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Hh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=sl.bind(null,this.syncEngine),[4,vh(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Dh},t.prototype.createDatastore=function(t){var e=Bc(t.databaseInfo.databaseId),n=new Fc(t.databaseInfo);return function(t,e,n){return new Hc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Hh(s.syncEngine,t,0)},o=Pc.yt()?new Pc:new Uc,new Yc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Vh(t,e,n,r,i,o);return s&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(Mr.b)(this,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return e=Xr(t),Gr("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,Jc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),El=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Ol=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new ja,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new Rh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t,e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(Mr.b)(this,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t,e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(Mr.b)(this,void 0,void 0,function(){var e,n=this;return Object(Mr.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Vr(qr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(Mr.d)(this,function(u){switch(u.label){case 0:return n=Xr(t),r=Gs(n.R)+"/documents",i={documents:e.map(function(t){return qs(n.R,t)})},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Yr(!!e.found);var n=Vs(t,e.found.name),r=Ls(e.found.updateTime),i=new Li({mapValue:{fields:e.found.fields}});return Fi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Yr(!!e.missing),Yr(!!e.readTime);var n=Vs(t,e.missing),r=Ls(e.readTime);return Fi.newNoDocument(n,r)}(t,e):Wr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Yr(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new ns(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Mr.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Ei.fromPath(n);e.mutations.push(new rs(r,e.precondition(r)))}),[4,function(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return n=Xr(t),r=Gs(n.R)+"/documents",i={writes:e.map(function(t){return Ws(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Wr();e=ri.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Vr(qr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Vo.updateTime(e):Vo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ri.min()))throw new Vr(qr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Vo.updateTime(e)}return Vo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),_l=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Kc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(Mr.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(Mr.d)(this,function(r){return t=new Ol(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!wi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!os(e)}return!1},t}(),Sl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Oc.UNAUTHENTICATED,this.clientId=$r.u(),this.credentialListener=function(){},this.receivedInitialUser=new ja,this.credentials.setChangeListener(function(t){Gr("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()})}return t.prototype.getConfiguration=function(){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}})})},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then(function(){return e.credentialListener(e.user)})},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Vr(qr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ja;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Mr.b)(t,void 0,void 0,function(){var t,n;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Ih(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function Dl(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Gr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable(function(){return Object(Mr.b)(i,void 0,void 0,function(){return Object(Mr.d)(this,function(t){switch(t.label){case 0:return[4,tc(e.localStore,n)];case 1:return t.sent(),[2]}})})}))}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function kl(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Al(t)];case 1:return n=i.sent(),Gr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(n){return t.asyncQueue.enqueueRetryable(function(){return function(t,e){return Object(Mr.b)(this,void 0,void 0,function(){var n,r;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return(n=Xr(t)).asyncQueue.verifyOperationInProgress(),Gr("RemoteStore","RemoteStore received new credentials"),r=ih(n),n.$r.add(3),[4,Jc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,Xc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,n)})}),t.onlineComponents=e,[2]}})})}function Al(t){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Gr("FirestoreClient","Using default OfflineComponentProvider"),[4,Dl(t,new bl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Nl(t){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Gr("FirestoreClient","Using default OnlineComponentProvider"),[4,kl(t,new Il)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function xl(t){return Al(t).then(function(t){return t.persistence})}function Cl(t){return Al(t).then(function(t){return t.localStore})}function jl(t){return Nl(t).then(function(t){return t.remoteStore})}function Rl(t){return Nl(t).then(function(t){return t.syncEngine})}function Ul(t){return Object(Mr.b)(this,void 0,void 0,function(){var e,n;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return[4,Nl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Bh.bind(null,e.syncEngine),n.onUnlisten=Gh.bind(null,e.syncEngine),n)]}})})}function Pl(t,e,n){var r=this;void 0===n&&(n={});var i=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(r,void 0,void 0,function(){var r;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new El({next:function(o){e.enqueueAndForget(function(){return Ah(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Vr(qr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Vr(qr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new jh(uo(n.path),o,{includeMetadataChanges:!0,so:!0});return kh(t,s)},[4,Ul(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Ll(t,e,n){var r=this;void 0===n&&(n={});var i=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(r,void 0,void 0,function(){var r;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new El({next:function(n){e.enqueueAndForget(function(){return Ah(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Vr(qr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new jh(n,o,{includeMetadataChanges:!0,so:!0});return kh(t,s)},[4,Ul(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Ml=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},Fl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),ql=new Map,Vl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Bl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(Oc.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Kl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t(this.token.user)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Gl=function(){function t(t){var e=this;this.oc=null,this.currentUser=Oc.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then(function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)},function(){}))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Gr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Yr("string"==typeof n.accessToken),new Vl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return Yr(null===t||"string"==typeof t),new Oc(t)},t}(),zl=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=Oc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),Ql=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new zl(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t(Oc.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Hl(t,e,n){if(!n)throw new Vr(qr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Wl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Vr(qr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Yl(t,e,n,r){if(!0===e&&!0===r)throw new Vr(qr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Xl(t){if(!Ei.isDocumentKey(t))throw new Vr(qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Jl(t){if(Ei.isDocumentKey(t))throw new Vr(qr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function $l(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Wr()}function Zl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Vr(qr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=$l(t);throw new Vr(qr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function tf(t,e){if(e<=0)throw new Vr(qr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var ef=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Vr(qr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Vr(qr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Yl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),nf=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ef({}),this._settingsFrozen=!1,t instanceof Fl?(this._databaseId=t,this._credentials=new Bl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Vr(qr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Fl(t.options.projectId)}(t),this._credentials=new Gl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Vr(qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Vr(qr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ef(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Bl;switch(t.type){case"gapi":var e=t.client;return Yr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ql(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Vr(qr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=ql.get(this))&&(Gr("ComponentProvider","Removing Datastore"),ql.delete(this),t.terminate()),Promise.resolve();var t},t}(),rf=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new sf(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),of=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),sf=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,uo(r))||this)._path=r,i.type="collection",i}return Object(Mr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new rf(this.firestore,null,new Ei(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(of);function af(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(R.h)(t),Hl("collection","path",e),t instanceof nf)return Jl(n=ui.fromString.apply(ui,Object(Mr.f)([e],r))),new sf(t,null,n);if(!(t instanceof rf||t instanceof sf))throw new Vr(qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Jl(n=ui.fromString.apply(ui,Object(Mr.f)([t.path],r)).child(ui.fromString(e))),new sf(t.firestore,null,n)}function uf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(R.h)(t),1===arguments.length&&(e=$r.u()),Hl("doc","path",e),t instanceof nf)return Xl(n=ui.fromString.apply(ui,Object(Mr.f)([e],r))),new rf(t,null,new Ei(n));if(!(t instanceof rf||t instanceof sf))throw new Vr(qr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Xl(n=t._path.child(ui.fromString.apply(ui,Object(Mr.f)([e],r)))),new rf(t.firestore,t instanceof sf?t.converter:null,new Ei(n))}function cf(t,e){return t=Object(R.h)(t),e=Object(R.h)(e),(t instanceof rf||t instanceof sf)&&(e instanceof rf||e instanceof sf)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function hf(t,e){return t=Object(R.h)(t),e=Object(R.h)(e),t instanceof of&&e instanceof of&&t.firestore===e.firestore&&vo(t._query,e._query)&&t.converter===e.converter}var lf=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new Kc(this,"async_queue_retry"),this.Ec=function(){var e=Vc();e&&Gr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Vc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=Vc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise(function(t){}):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.dc.push(t),e.Ac()})},t.prototype.Ac=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t,e=this;return Object(Mr.d)(this,function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!Fa(t=n.sent()))throw t;return Gr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji(function(){return e.Ac()}),n.label=5;case 5:return[2]}})})},t.prototype.Ic=function(t){var e=this,n=this.fc.then(function(){return e.yc=!0,t().catch(function(t){throw e.mc=t,e.yc=!1,zr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.yc=!1,t})});return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=Th.createAndSchedule(this,t,e,n,function(t){return r.Rc(t)});return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&Wr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return Object(Mr.b)(this,void 0,void 0,function(){var t;return Object(Mr.d)(this,function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then(function(){e._c.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()})},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function ff(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new ja,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var df=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new lf,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(Mr.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||yf(this),this._firestoreClient.terminate()},e}(nf);function pf(t){return t._firestoreClient||yf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function yf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Ml(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Sl(t._credentials,t._queue,r)}function gf(t,e,n){var r=this,i=new ja;return t.asyncQueue.enqueue(function(){return Object(Mr.b)(r,void 0,void 0,function(){var r;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Dl(t,n)];case 1:return o.sent(),[4,kl(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===qr.FAILED_PRECONDITION||t.code===qr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function mf(t){if(t._initialized||t._terminated)throw new Vr(qr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var vf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Vr(qr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new hi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),bf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(fi.fromBase64String(e))}catch(e){throw new Vr(qr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(fi.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),wf=function(t){this._methodName=t},Tf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Vr(qr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Vr(qr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Zr(this._lat,t._lat)||Zr(this._long,t._long)},t}(),If=/^__.*__$/,Ef=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Xo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Yo(t,this.data,e,this.fieldTransforms)},t}(),Of=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Xo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function _f(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Wr()}}var Sf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return Qf(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if(_f(this.Dc)&&If.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),Df=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Bc(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new Sf({Dc:t,methodName:e,Lc:n,path:hi.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function kf(t){var e=t._freezeSettings(),n=Bc(t._databaseId);return new Df(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Af(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);Bf("Data must be an object, but it was:",s,r);var a,u,c=qf(r,s);if(o.merge)a=new li(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Kf(e,f[l],n);if(!s.contains(d))throw new Vr(qr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Hf(h,d)||h.push(d)}a=new li(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Ef(new Li(c),a,u)}var Nf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Mr.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw t.$c(1===t.Dc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(wf);function xf(t,e,n){return new Sf({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Cf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Mr.c)(e,t),e.prototype._toFieldTransform=function(t){return new Fo(t.path,new xo)},e.prototype.isEqual=function(t){return t instanceof e},e}(wf),jf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Object(Mr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=xf(this,t,!0),n=this.qc.map(function(t){return Ff(t,e)}),r=new Co(n);return new Fo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(wf),Rf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return Object(Mr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=xf(this,t,!0),n=this.qc.map(function(t){return Ff(t,e)}),r=new Ro(n);return new Fo(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(wf),Uf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(Mr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new Po(t.R,So(t.R,this.Uc));return new Fo(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(wf);function Pf(t,e,n,r){var i=t.Bc(1,e,n);Bf("Data must be an object, but it was:",i,r);var o=[],s=Li.empty();oi(r,function(t,r){var a=zf(e,t,n);r=Object(R.h)(r);var u=i.kc(a);if(r instanceof Nf)o.push(a);else{var c=Ff(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new li(o);return new Of(s,a,i.fieldTransforms)}function Lf(t,e,n,r,i,o){var s=t.Bc(1,e,n),a=[Kf(e,r,n)],u=[i];if(o.length%2!=0)throw new Vr(qr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Kf(e,o[c])),u.push(o[c+1]);for(var h=[],l=Li.empty(),f=a.length-1;f>=0;--f)if(!Hf(h,a[f])){var d=a[f],p=u[f];p=Object(R.h)(p);var y=s.kc(d);if(p instanceof Nf)h.push(d);else{var g=Ff(p,y);null!=g&&(h.push(d),l.set(d,g))}}var m=new li(h);return new Of(l,m,s.fieldTransforms)}function Mf(t,e,n,r){return void 0===r&&(r=!1),Ff(n,t.Bc(r?4:3,e))}function Ff(t,e){if(Vf(t=Object(R.h)(t)))return Bf("Unsupported field value:",e,t),qf(t,e);if(t instanceof wf)return function(t,e){if(!_f(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Ff(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(R.h)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return So(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ni.fromDate(t);return{timestampValue:Rs(e.R,n)}}if(t instanceof ni)return n=new ni(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Rs(e.R,n)};if(t instanceof Tf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof bf)return{bytesValue:Us(e.R,t._byteString)};if(t instanceof rf){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.$c("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Ms(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+$l(t))}(t,e)}function qf(t,e){var n={};return si(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):oi(t,function(t,r){var i=Ff(r,e.Nc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Vf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ni||t instanceof Tf||t instanceof bf||t instanceof rf||t instanceof wf)}function Bf(t,e,n){if(!Vf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=$l(n);throw e.$c("an object"===r?t+" a custom object":t+" "+r)}}function Kf(t,e,n){if((e=Object(R.h)(e))instanceof vf)return e._internalPath;if("string"==typeof e)return zf(t,e);throw Qf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Gf=new RegExp("[~\\*/\\[\\]]");function zf(t,e,n){if(e.search(Gf)>=0)throw Qf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(vf.bind.apply(vf,Object(Mr.f)([void 0],e.split(".")))))._internalPath}catch(r){throw Qf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Qf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Vr(qr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Hf(t,e){return t.some(function(t){return t.isEqual(e)})}var Wf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new rf(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Yf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Xf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Yf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Mr.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Wf);function Xf(t,e){return"string"==typeof e?zf(t,e):e instanceof vf?e._internalPath:e._delegate._internalPath}var Jf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),$f=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(Mr.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Zf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Xf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Wf),Zf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Mr.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}($f),td=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Jf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Zf(n._firestore,n._userDataWriter,r.key,r,new Jf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Vr(qr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Zf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Jf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Zf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Jf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:ed(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function ed(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Wr()}}function nd(t,e){return t instanceof $f&&e instanceof $f?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof td&&e instanceof td&&t._firestore===e._firestore&&hf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function rd(t){if(ho(t)&&0===t.explicitOrderBy.length)throw new Vr(qr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var id=function(){};function od(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var sd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return Object(Mr.c)(e,t),e.prototype._apply=function(t){var e=kf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Vr(qr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){dd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(fd(r,t,h[c]));a={arrayValue:{values:u}}}else a=fd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||dd(s,o),a=Mf(n,"where",s,"in"===o||"not-in"===o);var l=zi.create(i,o,a);return function(t,e){if(e.g()){var n=fo(t);if(null!==n&&!n.isEqual(e.field))throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=lo(t);null!==r&&pd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Vr(qr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new of(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new so(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(id),ad=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return Object(Mr.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new no(e,n);return function(t,e){if(null===lo(t)){var n=fo(t);null!==n&&pd(0,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new of(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new so(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(id),ud=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return Object(Mr.c)(e,t),e.prototype._apply=function(t){return new of(t.firestore,t.converter,mo(t._query,this.Gc,this.zc))},e}(id),cd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(Mr.c)(e,t),e.prototype._apply=function(t){var e=ld(t,this.type,this.Hc,this.Jc);return new of(t.firestore,t.converter,function(t,e){return new so(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(id),hd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(Mr.c)(e,t),e.prototype._apply=function(t){var e=ld(t,this.type,this.Hc,this.Jc);return new of(t.firestore,t.converter,function(t,e){return new so(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(id);function ld(t,e,n,r){if(n[0]=Object(R.h)(n[0]),n[0]instanceof Wf)return function(t,e,n,r,i){if(!r)throw new Vr(qr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=yo(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(xi(e,r.key));else{var c=r.data.field(u.field);if(mi(c))throw new Vr(qr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new to(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=kf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Vr(qr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!po(t)&&-1!==c.indexOf("/"))throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ui.fromString(c));if(!Ei.isDocumentKey(h))throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Ei(h);a.push(xi(e,l))}else{var f=Mf(n,r,c);a.push(f)}}return new to(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function fd(t,e,n){if("string"==typeof(n=Object(R.h)(n))){if(""===n)throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!po(e)&&-1!==n.indexOf("/"))throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(ui.fromString(n));if(!Ei.isDocumentKey(r))throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return xi(t,new Ei(r))}if(n instanceof rf)return xi(t,n._key);throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+$l(n)+".")}function dd(t,e){if(!Array.isArray(t)||0===t.length)throw new Vr(qr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Vr(qr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function pd(t,e,n){if(!n.isEqual(e))throw new Vr(qr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var yd=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Oi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return yi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(gi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Wr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return oi(t.fields||{},function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new Tf(yi(t.latitude),yi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=vi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(bi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=pi(t);return new ni(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=ui.fromString(t);Yr(ca(n));var r=new Fl(n.get(1),n.get(3)),i=new Ei(n.popFirst(5));return r.isEqual(e)||zr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function gd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var md=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Mr.c)(e,t),e.prototype.convertBytes=function(t){return new bf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new rf(this.firestore,null,e)},e}(yd),vd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=kf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=bd(t,this._firestore),i=gd(r.converter,e,n),o=Af(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Vo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=bd(t,this._firestore);return o="string"==typeof(e=Object(R.h)(e))||e instanceof vf?Lf(this._dataReader,"WriteBatch.update",s._key,e,n,r):Pf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Vo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=bd(t,this._firestore);return this._mutations=this._mutations.concat(new ns(e._key,Vo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Vr(qr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function bd(t,e){if((t=Object(R.h)(t)).firestore!==e)throw new Vr(qr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var wd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Mr.c)(e,t),e.prototype.convertBytes=function(t){return new bf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new rf(this.firestore,null,e)},e}(yd);function Td(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Zl(t,rf);var o=Zl(t.firestore,df),s=kf(o);return Ed(o,[("string"==typeof(e=Object(R.h)(e))||e instanceof vf?Lf(s,"updateDoc",t._key,e,n,r):Pf(s,"updateDoc",t._key,e)).toMutation(t._key,Vo.exists(!0))])}function Id(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(R.h)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||ff(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(ff(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof rf)c=Zl(t.firestore,df),h=uo(t._key.path),u={next:function(e){i[a]&&i[a](Od(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Zl(t,of);c=Zl(d.firestore,df),h=d._query;var p=new wd(c);u={next:function(t){i[a]&&i[a](new td(c,p,d,t))},error:i[a+1],complete:i[a+2]},rd(t._query)}return function(t,e,n,r){var i=this,o=new El(r),s=new jh(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(i,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return e=kh,[4,Ul(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(i,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return e=Ah,[4,Ul(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(pf(c),h,l,u)}function Ed(t,e){return function(t,e){var n=this,r=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(n,void 0,void 0,function(){var n;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return n=zh,[4,Rl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(pf(t),e)}function Od(t,e,n){var r=n.docs.get(e._key),i=new wd(t);return new $f(t,i,e._key,r,new Jf(n.hasPendingWrites,n.fromCache),e.converter)}var _d=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(Mr.c)(e,t),e.prototype.get=function(e){var n=this,r=bd(e,this._firestore),i=new wd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new $f(n._firestore,i,r._key,t._document,new Jf(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=kf(t)}return t.prototype.get=function(t){var e=this,n=bd(t,this._firestore),r=new md(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Wr();var i=t[0];if(i.isFoundDocument())return new Wf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Wf(e._firestore,r,n._key,null,n.converter);throw Wr()})},t.prototype.set=function(t,e,n){var r=bd(t,this._firestore),i=gd(r.converter,e,n),o=Af(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=bd(t,this._firestore);return o="string"==typeof(e=Object(R.h)(e))||e instanceof vf?Lf(this._dataReader,"Transaction.update",s._key,e,n,r):Pf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=bd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Sd(){if("undefined"==typeof Uint8Array)throw new Vr(qr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Dd(){if("undefined"==typeof atob)throw new Vr(qr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var kd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Dd(),new t(bf.fromBase64String(e))},t.fromUint8Array=function(e){return Sd(),new t(bf.fromUint8Array(e))},t.prototype.toBase64=function(){return Dd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Sd(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Ad=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){mf(t=Zl(t,df));var n=pf(t),r=t._freezeSettings(),i=new Il;return gf(n,i,new wl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){mf(t=Zl(t,df));var e=pf(t),n=t._freezeSettings(),r=new Il;return gf(e,r,new Tl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Vr(qr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new ja;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(Mr.b)(e,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(Mr.b)(this,void 0,void 0,function(){return Object(Mr.d)(this,function(e){switch(e.label){case 0:return Pa.yt()?[4,Pa.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Hu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Nd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Fl||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Zl(t,nf))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Qr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=Object(R.d)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Vr(qr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Kl(new Vl(o,new Oc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Mr.b)(e,void 0,void 0,function(){var e,n;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return[4,xl(t)];case 1:return e=r.sent(),[4,jl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Xr(t);return e.$r.delete(0),Xc(e)}(n))]}})})})}(pf(Zl(this._delegate,df)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(Mr.b)(e,void 0,void 0,function(){var e,n;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return[4,xl(t)];case 1:return e=r.sent(),[4,jl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(Mr.b)(this,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return(e=Xr(t)).$r.add(0),[4,Jc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(pf(Zl(this._delegate,df)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Yl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(e,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(r){switch(r.label){case 0:return e=Jh,[4,Rl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(pf(Zl(this._delegate,df)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new El(e);return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(n,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Xr(t).Gr.add(e),e.next()},[4,Ul(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(n,void 0,void 0,function(){var e;return Object(Mr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Xr(t).Gr.delete(e)},[4,Ul(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(pf(t=Zl(t,df)),ff(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new Vr(qr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Gd(this,af(this._delegate,t))}catch(t){throw Pd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Ud(this,uf(this._delegate,t))}catch(t){throw Pd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Vd(this,function(t,e){if(t=Zl(t,nf),Hl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Vr(qr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new of(t,null,function(t){return new so(ui.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw Pd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(n,void 0,void 0,function(){var n;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Nl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new _l(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(pf(t),function(n){return e(new _d(t,n))})}(this._delegate,function(n){return t(new Cd(e,n))})},t.prototype.batch=function(){var t=this;return pf(this._delegate),new jd(new vd(this._delegate,function(e){return Ed(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Vr(qr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Vr(qr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),xd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(Mr.c)(e,t),e.prototype.convertBytes=function(t){return new kd(new bf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Ud.Zc(e,this.firestore,null)},e}(yd),Cd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new xd(t)}return t.prototype.get=function(t){var e=this,n=zd(t);return this._delegate.get(n).then(function(t){return new Fd(e._firestore,new $f(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=zd(t);return n?(Wl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=zd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Mr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=zd(t);return this._delegate.delete(e),this},t}(),jd=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=zd(t);return n?(Wl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=zd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(Mr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=zd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),Rd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Zf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new qd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new xd(e),n),i.set(n,o)),o},t}();Rd.eu=new WeakMap;var Ud=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new xd(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new Vr(qr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new rf(n._delegate,r,new Ei(e)))},t.Zc=function(e,n,r){return new t(n,new rf(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Gd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new Gd(this.firestore,af(this._delegate,t))}catch(t){throw Pd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(R.h)(t))instanceof rf&&cf(this._delegate,t)},t.prototype.set=function(t,e){e=Wl("DocumentReference.set",e);try{return function(t,e,n){t=Zl(t,rf);var r=Zl(t.firestore,df),i=gd(t.converter,e,n);return Ed(r,[Af(kf(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Vo.none())])}(this._delegate,t,e)}catch(t){throw Pd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Td(this._delegate,t):Td.apply(void 0,Object(Mr.f)([this._delegate,t,e],n))}catch(t){throw Pd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Ed(Zl((t=this._delegate).firestore,df),[new ns(t._key,Vo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Ld(e),i=Md(e,function(e){return new Fd(t.firestore,new $f(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return Id(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Zl(t,rf);var e=Zl(t.firestore,df),n=pf(e),r=new wd(e);return function(t,e){var n=this,r=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(n,void 0,void 0,function(){var n;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i;return Object(Mr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Xr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Vr(qr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Ih(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Cl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new $f(e,r,t._key,n,new Jf(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Zl(t,rf);var e=Zl(t.firestore,df);return Pl(pf(e),t._key,{source:"server"}).then(function(n){return Od(e,t,n)})}(this._delegate):function(t){t=Zl(t,rf);var e=Zl(t.firestore,df);return Pl(pf(e),t._key).then(function(n){return Od(e,t,n)})}(this._delegate)).then(function(t){return new Fd(e.firestore,new $f(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Rd.tu(this.firestore,e):null))},t}();function Pd(t,e,n){return t.message=t.message.replace(e,n),t}function Ld(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!ff(r))return r}return{}}function Md(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=ff(t[0])?t[0]:ff(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Fd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Ud(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return nd(this._delegate,t._delegate)},t}(),qd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(Mr.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Fd),Vd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new xd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,od(this._delegate,function(t,e,n){var r=e,i=Xf("where",t);return new sd(i,r,n)}(e,n,r)))}catch(e){throw Pd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,od(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Xf("orderBy",t);return new ad(r,n)}(e,n)))}catch(e){throw Pd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,od(this._delegate,function(t){return tf("limit",t),new ud("limit",t,"F")}(e)))}catch(e){throw Pd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,od(this._delegate,function(t){return tf("limitToLast",t),new ud("limitToLast",t,"L")}(e)))}catch(e){throw Pd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,od(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cd("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw Pd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,od(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cd("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw Pd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,od(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new hd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw Pd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,od(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new hd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw Pd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return hf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Zl(t,of);var e=Zl(t.firestore,df),n=pf(e),r=new wd(e);return function(t,e){var n=this,r=new ja;return t.asyncQueue.enqueueAndForget(function(){return Object(Mr.b)(n,void 0,void 0,function(){var n;return Object(Mr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(Mr.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(Mr.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,uc(t,e,!0)];case 1:return a=u.sent(),r=new Mh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Ih(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Cl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new td(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Zl(t,of);var e=Zl(t.firestore,df),n=pf(e),r=new wd(e);return Ll(n,t._query,{source:"server"}).then(function(n){return new td(e,r,t,n)})}(this._delegate):function(t){t=Zl(t,of);var e=Zl(t.firestore,df),n=pf(e),r=new wd(e);return rd(t._query),Ll(n,t._query).then(function(n){return new td(e,r,t,n)})}(this._delegate)).then(function(t){return new Kd(e.firestore,new td(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=Ld(e),i=Md(e,function(e){return new Kd(t.firestore,new td(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return Id(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?Rd.tu(this.firestore,e):null))},t}(),Bd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new qd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Kd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Vd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new qd(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Bd(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new qd(n._firestore,r))})},t.prototype.isEqual=function(t){return nd(this._delegate,t._delegate)},t}(),Gd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(Mr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Ud(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Ud(this.firestore,void 0===t?uf(this._delegate):uf(this._delegate,t))}catch(t){throw Pd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Zl(t.firestore,df),r=uf(t),i=gd(t.converter,e);return Ed(n,[Af(kf(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Vo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Ud(e.firestore,t)})},e.prototype.isEqual=function(t){return cf(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?Rd.tu(this.firestore,t):null))},e}(Vd);function zd(t){return Zl(t,rf)}var Qd,Hd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(vf.bind.apply(vf,Object(Mr.f)([void 0],t)))}return t.documentId=function(){return new t(hi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(R.h)(t))instanceof vf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Wd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Cf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Nf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new jf("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Rf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Uf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Yd=n("/6Yf"),Xd={Firestore:Nd,GeoPoint:Tf,Timestamp:ni,Blob:kd,Transaction:Cd,WriteBatch:jd,DocumentReference:Ud,DocumentSnapshot:Fd,Query:Vd,QueryDocumentSnapshot:qd,QuerySnapshot:Kd,CollectionReference:Gd,FieldPath:Hd,FieldValue:Wd,setLogLevel:function(t){Br.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Yd.a("firestore",function(t){return function(t,e){return new Nd(t,new df(t,e),new Ad)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Xd)))})(Qd=j.a),Qd.registerVersion("@firebase/firestore","2.3.0");var Jd=n("UbJi");function $d(t,e){return function(t,e=w.b){return new T.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Zd(t,e){return $d(t,e).pipe(Object(S.a)(t=>({payload:t,type:"query"})))}function tp(t,e){return Zd(t,e).pipe(Object(O.a)(void 0),Object(_.a)(),Object(S.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function ep(t,e,n){return tp(t,n).pipe(Object(D.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return np(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return np(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return np(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(k.a)(),Object(S.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function np(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function rp(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class ip{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=tp(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(S.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(O.a)(void 0),Object(_.a)(),Object(A.a)(([t,e])=>e.length>0||!t),Object(S.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(D.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=rp(t);return ep(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Zd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(S.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(I.a)(this.query.get(t)).pipe(Object(N.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new op(this.ref.doc(t),this.afs)}}class op{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=lp(n,e);return new ip(r,i,this.afs)}snapshotChanges(){return $d(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(O.a)(void 0),Object(_.a)(),Object(S.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(S.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(I.a)(this.ref.get(t)).pipe(Object(N.b)(this.afs.schedulers.insideAngular))}}class sp{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?tp(this.query,this.afs.schedulers.outsideAngular).pipe(Object(S.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(A.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):tp(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(D.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=rp(t);return ep(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Zd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(S.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(I.a)(this.query.get(t)).pipe(Object(N.b)(this.afs.schedulers.insideAngular))}}const ap=new o.s("angularfire2.enableFirestorePersistence"),up=new o.s("angularfire2.firestore.persistenceSettings"),cp=new o.s("angularfire2.firestore.settings"),hp=new o.s("angularfire2.firestore.use-emulator");function lp(t,e=(t=>t)){return{query:e(t),ref:t}}let fp=(()=>{class t{constructor(t,e,n,i,o,s,a,u,c){this.schedulers=new x.d(s),this.keepUnstableUntilFirst=Object(x.h)(this.schedulers);const h=Object(x.g)(t,s,e);!C.a.auth&&c&&Object(x.j)();const l=u;[this.firestore,this.persistenceEnabled$]=Object(x.f)(`${h.name}.firestore`,"AngularFirestore",h,()=>{const t=s.runOutsideAngular(()=>h.firestore());if(i&&t.settings(i),l&&t.useEmulator(...l),n&&!Object(r.u)(o)){const e=()=>{try{return Object(I.a)(t.enablePersistence(a||void 0).then(()=>!0,()=>!1))}catch(Qd){return"undefined"!=typeof console&&console.warn(Qd),Object(E.a)(!1)}};return[t,s.runOutsideAngular(e)]}return[t,Object(E.a)(!1)]},[i,l,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=lp(n,e),o=this.schedulers.ngZone.run(()=>r);return new ip(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new sp(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new op(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(o.Yb(x.c),o.Yb(x.b,8),o.Yb(ap,8),o.Yb(cp,8),o.Yb(o.D),o.Yb(o.B),o.Yb(up,8),o.Yb(hp,8),o.Yb(Jd.b,8))},t.\u0275prov=o.Kb({factory:function(){return new t(o.Yb(x.c),o.Yb(x.b,8),o.Yb(ap,8),o.Yb(cp,8),o.Yb(o.D),o.Yb(o.B),o.Yb(up,8),o.Yb(hp,8),o.Yb(Jd.b,8))},token:t,providedIn:"any"}),t})();var dp=n("kmnG"),pp=n("qFsG"),yp=n("3Pt+");let gp=(()=>{class t{constructor(t,e,n,r,i){this.dialogRef=t,this.data=e,this.api=n,this.db=r,this.auth=i,this.userData={}}ngOnInit(){this.auth.user.subscribe(t=>{this.userData=t})}saveData(){if(this.loading=!0,null==this.data.id){let t=(new Date).getTime().toString();this.data.uid=this.userData.uid,this.db.collection("addresslist").doc(t).set(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Cannot save data")})}else this.db.collection("addresslist").doc(this.data.id).update(this.data).then(t=>{this.dialogRef.close(this.data),this.loading=!1}).catch(t=>{console.log(t),this.loading=!1,alert("Cannot save data")})}}return t.\u0275fac=function(e){return new(e||t)(o.Ob(b.g),o.Ob(b.a),o.Ob(s.a),o.Ob(fp),o.Ob(Jd.a))},t.\u0275cmp=o.Ib({type:t,selectors:[["app-address-detail"]],decls:53,vars:13,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["appearance","outline",2,"width","100%"],["matInput","","placeholder","Ex. Dimas Rizki Novyadi",3,"ngModel","ngModelChange"],["matInput","","placeholder","Ex. Jalan Merdeka III",3,"ngModel","ngModelChange"],["matInput","","placeholder","RT Number",3,"ngModel","ngModelChange"],["matInput","","placeholder","RW Number",3,"ngModel","ngModelChange"],["matInput","","placeholder","Ex. Andong",3,"ngModel","ngModelChange"],["matInput","","placeholder","Ex. New York",3,"ngModel","ngModelChange"],["matInput","","placeholder","Ex. East Java",3,"ngModel","ngModelChange"],["matInput","","type","number","placeholder","Postal Code",3,"ngModel","ngModelChange"],["matInput","","placeholder","Ex. United Kingdom",3,"ngModel","ngModelChange"],["matInput","","placeholder","Ex. 1234567890",3,"ngModel","ngModelChange"],["matInput","","placeholder","Ex. email@domain.com",3,"ngModel","ngModelChange"],["mat-dialog-actions","","align","end"],["mat-raised-button","","mat-dialog-close",""],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(t,e){1&t&&(o.Ub(0,"h1",0),o.Ub(1,"b"),o.yc(2,"Address Data"),o.Tb(),o.Tb(),o.Ub(3,"div",1),o.Ub(4,"mat-form-field",2),o.Ub(5,"mat-label"),o.yc(6,"Name"),o.Tb(),o.Ub(7,"input",3),o.bc("ngModelChange",function(t){return e.data.name=t}),o.Tb(),o.Tb(),o.Ub(8,"mat-form-field",2),o.Ub(9,"mat-label"),o.yc(10,"Location"),o.Tb(),o.Ub(11,"input",4),o.bc("ngModelChange",function(t){return e.data.location=t}),o.Tb(),o.Tb(),o.Ub(12,"mat-form-field",2),o.Ub(13,"mat-label"),o.yc(14,"RT"),o.Tb(),o.Ub(15,"input",5),o.bc("ngModelChange",function(t){return e.data.rt=t}),o.Tb(),o.Tb(),o.Ub(16,"mat-form-field",2),o.Ub(17,"mat-label"),o.yc(18,"RW"),o.Tb(),o.Ub(19,"input",6),o.bc("ngModelChange",function(t){return e.data.rw=t}),o.Tb(),o.Tb(),o.Ub(20,"mat-form-field",2),o.Ub(21,"mat-label"),o.yc(22,"Sub-District/Village"),o.Tb(),o.Ub(23,"input",7),o.bc("ngModelChange",function(t){return e.data.village=t}),o.Tb(),o.Tb(),o.Ub(24,"mat-form-field",2),o.Ub(25,"mat-label"),o.yc(26,"District/City"),o.Tb(),o.Ub(27,"input",8),o.bc("ngModelChange",function(t){return e.data.district=t}),o.Tb(),o.Tb(),o.Ub(28,"mat-form-field",2),o.Ub(29,"mat-label"),o.yc(30,"Province"),o.Tb(),o.Ub(31,"input",9),o.bc("ngModelChange",function(t){return e.data.province=t}),o.Tb(),o.Tb(),o.Ub(32,"mat-form-field",2),o.Ub(33,"mat-label"),o.yc(34,"Zip Code"),o.Tb(),o.Ub(35,"input",10),o.bc("ngModelChange",function(t){return e.data.zip=t}),o.Tb(),o.Tb(),o.Ub(36,"mat-form-field",2),o.Ub(37,"mat-label"),o.yc(38,"Country"),o.Tb(),o.Ub(39,"input",11),o.bc("ngModelChange",function(t){return e.data.country=t}),o.Tb(),o.Tb(),o.Ub(40,"mat-form-field",2),o.Ub(41,"mat-label"),o.yc(42,"Phone Number"),o.Tb(),o.Ub(43,"input",12),o.bc("ngModelChange",function(t){return e.data.phone=t}),o.Tb(),o.Tb(),o.Ub(44,"mat-form-field",2),o.Ub(45,"mat-label"),o.yc(46,"Email"),o.Tb(),o.Ub(47,"input",13),o.bc("ngModelChange",function(t){return e.data.email=t}),o.Tb(),o.Tb(),o.Tb(),o.Ub(48,"div",14),o.Ub(49,"button",15),o.yc(50,"Cancel"),o.Tb(),o.Ub(51,"button",16),o.bc("click",function(){return e.saveData()}),o.yc(52),o.Tb(),o.Tb()),2&t&&(o.Db(7),o.kc("ngModel",e.data.name),o.Db(4),o.kc("ngModel",e.data.location),o.Db(4),o.kc("ngModel",e.data.rt),o.Db(4),o.kc("ngModel",e.data.rw),o.Db(4),o.kc("ngModel",e.data.village),o.Db(4),o.kc("ngModel",e.data.district),o.Db(4),o.kc("ngModel",e.data.province),o.Db(4),o.kc("ngModel",e.data.zip),o.Db(4),o.kc("ngModel",e.data.country),o.Db(4),o.kc("ngModel",e.data.phone),o.Db(4),o.kc("ngModel",e.data.email),o.Db(4),o.kc("disabled",e.loading),o.Db(1),o.zc(e.loading?"Saving..":"Save"))},directives:[b.h,b.e,dp.c,dp.f,pp.b,yp.c,yp.j,yp.l,yp.m,b.c,c.a,b.d],styles:[""]}),t})(),mp=(()=>{class t{constructor(t,e,n){this.api=t,this.dialogRef=e,this.dialogData=n}ngOnInit(){console.log(this.dialogData)}onFileChange(t){t.target.files.length>0&&(this.selectedFile=t.target.files[0],console.log(this.selectedFile))}uploadFile(){let t=new FormData;t.append("file",this.selectedFile),this.loadingUpload=!0,this.api.upload(t).subscribe(t=>{this.updateAddress(t),console.log(t)},t=>{this.loadingUpload=!1,alert("Upload file failed")})}updateAddress(t){1==t.status?(this.updateAddresslist(t),alert("Upload file successfully"),this.loadingUpload=!1,this.dialogRef.close()):alert(t.message)}updateAddresslist(t){this.api.put("addresslist/"+this.dialogData.id,{url:t.url}).subscribe(t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(o.Ob(s.a),o.Ob(b.g),o.Ob(b.a))},t.\u0275cmp=o.Ib({type:t,selectors:[["app-upload"]],decls:13,vars:3,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[1,"uk-flex","uk-flex-middle","uk-flex-center",2,"height","100px","outline","2px dashed #ccc","margin","10px",3,"click"],["type","file","id","file",2,"display","none",3,"change"],["fileInput",""],["mat-dialog-actions","","align","right"],["mat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"disabled","click"]],template:function(t,e){if(1&t){const t=o.Vb();o.Ub(0,"h1",0),o.yc(1,"Upload File"),o.Tb(),o.Ub(2,"div",1),o.Ub(3,"div",2),o.bc("click",function(){return o.rc(t),o.pc(7).click()}),o.Ub(4,"span"),o.yc(5),o.Tb(),o.Tb(),o.Ub(6,"input",3,4),o.bc("change",function(t){return e.onFileChange(t)}),o.Tb(),o.Tb(),o.Ub(8,"div",5),o.Ub(9,"button",6),o.yc(10,"Cancel"),o.Tb(),o.Ub(11,"button",7),o.bc("click",function(){return e.uploadFile()}),o.yc(12),o.Tb(),o.Tb()}2&t&&(o.Db(5),o.zc(e.selectedFile?e.selectedFile.name:"Select File"),o.Db(6),o.kc("disabled",e.loadingUpload),o.Db(1),o.zc(e.loadingUpload?"Uploading..":"Upload"))},directives:[b.h,b.e,b.c,c.a,b.d],styles:[""]}),t})();var vp=n("bv9b");function bp(t,e){1&t&&(o.Ub(0,"div",2),o.Pb(1,"mat-progress-bar",3),o.Tb())}function wp(t,e){if(1&t){const t=o.Vb();o.Ub(0,"tr"),o.Ub(1,"td",10),o.Ub(2,"button",12),o.bc("click",function(){o.rc(t);const n=e.$implicit,r=e.index;return o.fc(2).addressDetail(n,r)}),o.Ub(3,"mat-icon"),o.yc(4,"edit"),o.Tb(),o.Tb(),o.Ub(5,"button",13),o.bc("click",function(){o.rc(t);const n=e.$implicit,r=e.index;return o.fc(2).deleteAddress(n.id,r)}),o.Ub(6,"mat-icon"),o.yc(7,"delete"),o.Tb(),o.yc(8),o.Tb(),o.Tb(),o.Ub(9,"td"),o.yc(10),o.Tb(),o.Ub(11,"td"),o.yc(12),o.Tb(),o.Ub(13,"td"),o.yc(14),o.Tb(),o.Ub(15,"td"),o.yc(16),o.Tb(),o.Ub(17,"td"),o.yc(18),o.Tb(),o.Ub(19,"td"),o.yc(20),o.Tb(),o.Ub(21,"td"),o.yc(22),o.Tb(),o.Ub(23,"td"),o.yc(24),o.Tb(),o.Ub(25,"td"),o.yc(26),o.Tb(),o.Ub(27,"td"),o.yc(28),o.Tb(),o.Ub(29,"td"),o.yc(30),o.Tb(),o.Ub(31,"td"),o.yc(32),o.Tb(),o.Tb()}if(2&t){const t=e.$implicit,n=e.index,r=o.fc(2);o.Db(5),o.kc("disabled",r.loadingDelete[n]),o.Db(3),o.zc(r.loadingDelete[n]?"Deleting..":""),o.Db(2),o.zc(n+1),o.Db(2),o.zc(t.name),o.Db(2),o.zc(t.location),o.Db(2),o.zc(t.rt),o.Db(2),o.zc(t.rw),o.Db(2),o.zc(t.village),o.Db(2),o.zc(t.district),o.Db(2),o.zc(t.province),o.Db(2),o.zc(t.zip),o.Db(2),o.zc(t.country),o.Db(2),o.zc(t.phone),o.Db(2),o.zc(t.email)}}function Tp(t,e){if(1&t){const t=o.Vb();o.Ub(0,"mat-card",4),o.Ub(1,"mat-card-header"),o.Ub(2,"mat-card-title",5),o.yc(3),o.Tb(),o.Tb(),o.Ub(4,"mat-card-content"),o.Ub(5,"div",6),o.Pb(6,"span",7),o.Ub(7,"button",8),o.bc("click",function(){return o.rc(t),o.fc().addressDetail({},-1)}),o.Ub(8,"mat-icon"),o.yc(9,"add"),o.Tb(),o.yc(10,"Create Address"),o.Tb(),o.Tb(),o.Ub(11,"table",9),o.Ub(12,"thead"),o.Ub(13,"th",10),o.yc(14,"#"),o.Tb(),o.Ub(15,"th"),o.yc(16,"No."),o.Tb(),o.Ub(17,"th"),o.yc(18,"Name"),o.Tb(),o.Ub(19,"th"),o.yc(20,"Location"),o.Tb(),o.Ub(21,"th"),o.yc(22,"RT"),o.Tb(),o.Ub(23,"th"),o.yc(24,"RW"),o.Tb(),o.Ub(25,"th"),o.yc(26,"Sub-District / Village"),o.Tb(),o.Ub(27,"th"),o.yc(28,"District / City"),o.Tb(),o.Ub(29,"th"),o.yc(30,"Province"),o.Tb(),o.Ub(31,"th"),o.yc(32,"Zip Code"),o.Tb(),o.Ub(33,"th"),o.yc(34,"Country"),o.Tb(),o.Ub(35,"th"),o.yc(36,"Phone Number"),o.Tb(),o.Ub(37,"th"),o.yc(38,"Email"),o.Tb(),o.Tb(),o.Ub(39,"tbody"),o.xc(40,wp,33,14,"tr",11),o.Tb(),o.Tb(),o.Tb(),o.Tb()}if(2&t){const t=o.fc();o.Db(3),o.zc(t.title),o.Db(37),o.kc("ngForOf",t.addresslist)}}let Ip=(()=>{class t{constructor(t,e,n,r){this.dialog=t,this.api=e,this.db=n,this.auth=r,this.addressdata={},this.addresslist=[],this.userData={},this.loadingDelete={}}ngOnInit(){this.title="Address List",this.auth.user.subscribe(t=>{this.userData=t,this.getAddress()})}getAddress(){this.loading=!0,this.db.collection("addresslist",t=>t.where("uid","==",this.userData.uid)).valueChanges({idField:"id"}).subscribe(t=>{console.log(t),this.addresslist=t,this.loading=!1},t=>{this.loading=!1})}addressDetail(t,e){this.dialog.open(gp,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}deleteAddress(t,e){confirm("Do you want to delete this address ?")&&this.db.collection("addresslist").doc(t).delete().then(t=>{this.addresslist.splice(e,1),this.loadingDelete[e]=!1}).catch(t=>{this.loadingDelete[e]=!1,alert("Cannot delete data")})}uploadFile(t,e){this.dialog.open(mp,{width:"400px",data:t}).afterClosed().subscribe(t=>{})}downloadFile(t){v.saveAs("(link/tautan API disini)"+t.url)}}return t.\u0275fac=function(e){return new(e||t)(o.Ob(b.b),o.Ob(s.a),o.Ob(fp),o.Ob(Jd.a))},t.\u0275cmp=o.Ib({type:t,selectors:[["app-address"]],decls:2,vars:2,consts:[["style","height: 300px;","class","uk-flex uk-flex-center uk-flex-middle",4,"ngIf"],["class","uk-margin-large-top uk-animation-toggle uk-animation-slide-top","style","display:inline-table;",4,"ngIf"],[1,"uk-flex","uk-flex-center","uk-flex-middle",2,"height","300px"],["mode","indeterminate"],[1,"uk-margin-large-top","uk-animation-toggle","uk-animation-slide-top",2,"display","inline-table"],[1,"title","uk-margin-medium-top"],[1,"uk-flex"],[1,"uk-width-expand"],["mat-flat-button","","color","primary",3,"click"],[1,"uk-table","uk-table-middle","uk-table-divider"],["align","center"],[4,"ngFor","ngForOf"],["mat-button","","color","primary",3,"click"],["mat-button","","color","warn",3,"disabled","click"]],template:function(t,e){1&t&&(o.xc(0,bp,2,0,"div",0),o.xc(1,Tp,41,2,"mat-card",1)),2&t&&(o.kc("ngIf",e.loading),o.Db(1),o.kc("ngIf",!e.loading))},directives:[r.k,vp.a,y.a,y.c,y.e,y.b,c.a,h.a,r.j],styles:[".title[_ngcontent-%COMP%]{font-family:Georgia,Times New Roman,Times,serif;font-size:xx-large;font-style:bold}"]}),t})();var Ep=n("tk/3");const Op=[{path:"",component:p,children:[{path:"dashboard",component:g},{path:"address",component:Ip},{path:"about",component:(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Ib({type:t,selectors:[["app-about"]],decls:90,vars:0,consts:[[1,"uk-article","uk-card","uk-card-default","uk-card-body","uk-animation-toggle","uk-animation-fade","uk-margin-large-top"],[1,"uk-article-title"],["href","",1,"uk-link-reset"],[1,"uk-article-meta"],[1,"uk-text-lead"],["uk-grid","",1,"uk-grid-small","uk-child-width-auto"],["href","https://www.instagram.com/dimasriznov18/"]],template:function(t,e){1&t&&(o.Ub(0,"article",0),o.Ub(1,"h1",1),o.Ub(2,"a",2),o.Ub(3,"b"),o.yc(4,"About this web application"),o.Tb(),o.Tb(),o.Tb(),o.Ub(5,"p",3),o.yc(6,"Written by Dimas Rizki Novyadi on 9 July 2021. "),o.Tb(),o.Ub(7,"p",4),o.yc(8,"ADDRESS BOOK"),o.Tb(),o.Ub(9,"p"),o.yc(10,"Address Book is a simple, easy and fast website-based application. You can collect other people's address data easily in a fast process. This web application can be useful as a substitute for using an address book which is generally written manually, so that it can be accessed on any device. This web application was created using the Angular Framework service with CRUD (Create, Read, Update, Delete) and Authentication (Login, Register, Forgot) features and use Firebase services as a data repository. With this Authentication feature, all address data of someone that is considered important will be stored safely."),o.Tb(),o.Ub(11,"div",5),o.Ub(12,"h2"),o.yc(13,"Info about web applications :"),o.Tb(),o.Ub(14,"table"),o.Ub(15,"tr"),o.Ub(16,"td"),o.yc(17,"Web Application Type"),o.Tb(),o.Ub(18,"td"),o.yc(19,":"),o.Tb(),o.Ub(20,"td"),o.yc(21,"A place to store people's address data"),o.Tb(),o.Tb(),o.Ub(22,"tr"),o.Ub(23,"td"),o.yc(24,"Framework"),o.Tb(),o.Ub(25,"td"),o.yc(26,":"),o.Tb(),o.Ub(27,"td"),o.yc(28,"Angular"),o.Tb(),o.Tb(),o.Ub(29,"tr"),o.Ub(30,"td"),o.yc(31,"Data Storage Service"),o.Tb(),o.Ub(32,"td"),o.yc(33,":"),o.Tb(),o.Ub(34,"td"),o.yc(35,"Firebase"),o.Tb(),o.Tb(),o.Ub(36,"tr"),o.Ub(37,"td"),o.yc(38,"Web Application Creator"),o.Tb(),o.Ub(39,"td"),o.yc(40,":"),o.Tb(),o.Ub(41,"td"),o.yc(42,"Dimas Rizki Novyadi"),o.Tb(),o.Tb(),o.Ub(43,"tr"),o.Ub(44,"td"),o.yc(45,"Date Created"),o.Tb(),o.Ub(46,"td"),o.yc(47,":"),o.Tb(),o.Ub(48,"td"),o.yc(49,"15 May 2021"),o.Tb(),o.Tb(),o.Ub(50,"tr"),o.Ub(51,"td"),o.yc(52,"Publication Date"),o.Tb(),o.Ub(53,"td"),o.yc(54,":"),o.Tb(),o.Ub(55,"td"),o.yc(56,"31 July 2021"),o.Tb(),o.Tb(),o.Tb(),o.Pb(57,"br"),o.Ub(58,"h3"),o.Ub(59,"b"),o.yc(60,"More info contact me at :"),o.Tb(),o.Tb(),o.Ub(61,"table"),o.Ub(62,"tr"),o.Ub(63,"td"),o.yc(64,"INSTAGRAM"),o.Tb(),o.Ub(65,"td"),o.yc(66,":"),o.Tb(),o.Ub(67,"td"),o.Ub(68,"a",6),o.yc(69,"dimasriznov18"),o.Tb(),o.Tb(),o.Tb(),o.Ub(70,"tr"),o.Ub(71,"td"),o.yc(72,"WHATSAPP"),o.Tb(),o.Ub(73,"td"),o.yc(74,":"),o.Tb(),o.Ub(75,"td"),o.yc(76,"082159823576"),o.Tb(),o.Tb(),o.Ub(77,"tr"),o.Ub(78,"td"),o.yc(79,"EMAIL"),o.Tb(),o.Ub(80,"td"),o.yc(81,":"),o.Tb(),o.Ub(82,"td"),o.yc(83,"- dimasriznov18@gmail.com"),o.Tb(),o.Tb(),o.Ub(84,"tr"),o.Pb(85,"td"),o.Pb(86,"td"),o.Ub(87,"td"),o.yc(88,"- dimas1900016071@webmail.uad.ac.id"),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Tb(),o.Pb(89,"router-outlet"))},directives:[a.d],styles:["h1[_ngcontent-%COMP%]{font-family:Times New Roman,Times,serif}.char[_ngcontent-%COMP%]{color:#fff}"]}),t})()},{path:"",redirectTo:"/admin/dashboard",pathMatch:"full"}]}];let _p=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.Mb({type:t}),t.\u0275inj=o.Lb({imports:[[r.c,a.c.forChild(Op),m.a,yp.f,Ep.b]]}),t})()}}]);